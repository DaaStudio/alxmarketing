<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Buddy Products</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff3366;
            --primary-dark: #e62e5e;
            --secondary: #7c5cff;
            --dark: #0f172a;
            --light: #f8f9fa;
            --gray: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --border-radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
            
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --card-bg: #1e293b;
            --header-bg: linear-gradient(135deg, var(--primary), var(--secondary));
            --footer-bg: var(--dark);
            --image-border: #334155;
        }

        [data-theme="light"] {
            --bg-color: #f5f7fa;
            --text-color: #333;
            --card-bg: white;
            --header-bg: linear-gradient(135deg, var(--primary), var(--secondary));
            --footer-bg: var(--dark);
            --image-border: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header */
        header {
            background: var(--header-bg);
            color: white;
            padding: 12px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .logo {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .logo i {
            margin-right: 6px;
            font-size: 1.3rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .theme-toggle, .language-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .theme-toggle:hover, .language-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .search-bar {
            display: flex;
            background: white;
            border-radius: 50px;
            overflow: hidden;
            min-width: 120px;
            flex: 1;
            max-width: 300px;
        }

        .search-bar input {
            flex: 1;
            border: none;
            padding: 6px 12px;
            outline: none;
            font-size: 0.85rem;
            color: var(--dark);
        }

        .search-bar button {
            background: var(--primary);
            border: none;
            color: white;
            padding: 0 12px;
            cursor: pointer;
            transition: var(--transition);
            min-width: 40px;
        }

        .search-bar button:hover {
            background: var(--primary-dark);
        }

        /* Language Dropdown */
        .language-selector {
            position: relative;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            min-width: 160px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1001;
            margin-top: 5px;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--gray);
            transition: var(--transition);
            font-size: 0.85rem;
        }

        .language-option:hover {
            background: var(--primary);
            color: white;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            z-index: 1002;
            opacity: 0;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Hero */
        .hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1607082350899-7e105aa886ae?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 20px;
        }

        .hero h1 {
            font-size: 1.4rem;
            margin-bottom: 8px;
        }

        .hero p {
            font-size: 0.9rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Status */
        .status-info {
            background: var(--card-bg);
            padding: 12px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            text-align: center;
            font-size: 0.9rem;
        }

        /* Categories */
        .categories {
            display: flex;
            gap: 6px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: center;
        }

        .category-btn {
            background: var(--card-bg);
            border: 2px solid var(--gray);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: var(--transition);
            color: var(--text-color);
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* Sort Button */
        .sort-select {
            padding: 6px 12px;
            border-radius: 20px;
            border: 2px solid var(--gray);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 0.75rem;
            min-width: 120px;
            cursor: pointer;
            transition: var(--transition);
        }

        .sort-select:hover {
            border-color: var(--secondary);
        }

        /* Favorites Management */
        .favorites-management {
            background: var(--card-bg);
            padding: 12px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            display: none;
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
        }

        .favorites-management.show {
            display: flex;
        }

        .clear-favorites-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.8rem;
            width: auto;
            min-width: 120px;
        }

        .clear-favorites-btn:hover {
            background: var(--primary-dark);
        }

        #favorites-count {
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Confirmation Modal */
        .confirmation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .confirmation-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .confirmation-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .confirmation-modal.show .confirmation-content {
            transform: translateY(0);
        }

        .confirmation-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--header-bg);
            color: white;
        }

        .confirmation-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .confirmation-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .confirmation-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .confirmation-body {
            padding: 20px;
            text-align: center;
        }

        .confirmation-message {
            font-size: 1rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .confirmation-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .confirm-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.9rem;
            min-width: 80px;
        }

        .confirm-btn:hover {
            background: var(--primary-dark);
        }

        .cancel-btn {
            background: var(--gray);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.9rem;
            min-width: 80px;
        }

        .cancel-btn:hover {
            background: #5a6268;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            padding: 1rem;
            max-width: 1300px;
            margin: 0 auto;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: var(--shadow);
            transition: transform .2s;
        }

        .product-card:hover {
            transform: translateY(-6px);
        }

        .product-image-container {
            position: relative;
            cursor: pointer;
            margin-bottom: .6rem;
        }

        .product-image {
            width: 100%;
            border-radius: var(--border-radius);
            object-fit: cover;
        }

        .product-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 2;
        }

        .category-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: var(--secondary);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 2;
        }

        .remove-favorite-btn {
            position: absolute;
            top: 40px;
            right: 8px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            opacity: 0;
            z-index: 3;
            font-size: 0.7rem;
            color: var(--dark);
        }

        .product-card:hover .remove-favorite-btn {
            opacity: 1;
        }

        .remove-favorite-btn:hover {
            background: var(--primary);
            color: white;
        }

        .product-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-title {
            font-weight: 600;
            margin: .6rem 0;
            font-size: 0.95rem;
            min-height: 40px;
            line-height: 1.3;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .product-title.short {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-title.long {
            display: block;
        }

        .product-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--card-bg));
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .product-title.long::after {
            opacity: 0;
        }

        .product-price {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 4px;
            flex-wrap: wrap;
        }

        .current-price {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .original-price {
            font-size: 0.9rem;
            color: var(--gray);
            text-decoration: line-through;
        }

        .discount {
            background: var(--success);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .product-code {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .code-label {
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .code-value {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .code-value:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .product-actions {
            display: flex;
            gap: 8px;
            margin-top: .8rem;
        }

        .buy-btn {
            flex: 2;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
        }

        .buy-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.02);
        }

        .wishlist-btn, .share-btn {
            flex: 1;
            background: var(--card-bg);
            border: 1px solid var(--gray);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: var(--text-color);
        }

        .wishlist-btn.active {
            background: #ff4757;
            color: white;
            border-color: #ff4757;
        }

        .wishlist-btn:hover, .share-btn:hover {
            background: var(--secondary);
            color: white;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading-spinner {
            border: 2px solid var(--gray);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            width: 25px;
            height: 25px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        .loading p {
            font-size: 0.9rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* End of Results */
        .end-of-results {
            text-align: center;
            padding: 30px 15px;
            color: var(--gray);
            display: none;
            grid-column: 1 / -1;
        }

        .end-of-results i {
            font-size: 2rem;
            margin-bottom: 12px;
            color: var(--gray);
        }

        .end-of-results h3 {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .end-of-results p {
            font-size: 0.9rem;
        }

        /* No Favorites */
        .no-favorites {
            text-align: center;
            padding: 40px 15px;
            color: var(--gray);
            display: none;
            grid-column: 1 / -1;
        }

        .no-favorites i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            color: var(--gray);
        }

        .no-favorites h3 {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .no-favorites p {
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            background: var(--footer-bg);
            color: white;
            padding: 25px 0 12px;
            margin-top: 30px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .footer-section h3 {
            margin-bottom: 12px;
            font-size: 1rem;
        }

        .footer-section p, .footer-section ul li a {
            font-size: 0.85rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 6px;
        }

        .footer-section ul li a {
            color: #bbb;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-section ul li a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 12px;
            border-top: 1px solid #444;
            color: #bbb;
            font-size: 0.75rem;
        }

        /* Copy Message */
        .copy-msg {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 12px 18px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
            box-shadow: 0 0 20px rgba(124,92,255,0.4);
            z-index: 1003;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--header-bg);
            color: white;
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        .categories-modal-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .category-modal-item {
            padding: 12px 20px;
            border-bottom: 1px solid var(--gray);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-modal-item:last-child {
            border-bottom: none;
        }

        .category-modal-item:hover {
            background: var(--primary);
            color: white;
        }

        .category-modal-item.active {
            background: var(--secondary);
            color: white;
        }

        .category-name {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-count {
            background: var(--gray);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }

        .category-modal-item:hover .category-count,
        .category-modal-item.active .category-count {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 8px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-bar {
                width: 100%;
                margin-top: 8px;
                max-width: none;
                order: 3;
            }
            
            .logo {
                font-size: 1rem;
            }
            
            .logo i {
                font-size: 1.2rem;
            }
            
            .hero {
                padding: 30px 15px;
            }
            
            .hero h1 {
                font-size: 1.2rem;
            }
            
            .hero p {
                font-size: 0.85rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 15px;
                padding: 0.5rem;
            }
            
            .language-dropdown {
                right: auto;
                left: 0;
            }
            
            /* Mobil için özel düzenlemeler */
            .categories {
                justify-content: flex-start;
                gap: 6px;
            }
            
            .sort-select {
                width: auto;
                min-width: 120px;
                margin-left: auto;
            }
            
            .product-code {
                flex-direction: column;
                gap: 4px;
                text-align: center;
            }
            
            .code-label, .code-value {
                width: 100%;
                justify-content: center;
            }
            
            .product-actions {
                flex-direction: row;
                gap: 4px;
            }
            
            .buy-btn, .wishlist-btn, .share-btn {
                padding: 8px;
                font-size: 0.7rem;
            }

            .product-title {
                font-size: 0.85rem;
                min-height: 36px;
            }
            
            /* Favorites Management Responsive */
            .favorites-management {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .clear-favorites-btn {
                width: auto;
                min-width: 120px;
            }
            
            /* Confirmation Modal Responsive */
            .confirmation-content {
                max-width: 90%;
            }
            
            .confirmation-header {
                padding: 12px 15px;
            }
            
            .confirmation-title {
                font-size: 1rem;
            }
            
            .confirmation-body {
                padding: 15px;
            }
            
            .confirmation-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .confirm-btn, .cancel-btn {
                width: 100%;
            }
            
            /* Modal Responsive */
            .modal-content {
                max-width: 90%;
            }
            
            .modal-header {
                padding: 12px 15px;
            }
            
            .modal-title {
                font-size: 1rem;
            }
            
            .category-modal-item {
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .header-actions {
                gap: 6px;
            }
            
            .theme-toggle, .language-btn {
                padding: 4px 8px;
                font-size: 0.75rem;
            }
            
            .theme-toggle span, .language-btn span {
                display: none;
            }
            
            .search-bar input {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 0.5rem;
            }
            
            .product-card {
                padding: 0.8rem;
            }
            
            .product-title {
                font-size: 0.75rem;
                min-height: 32px;
            }
            
            .current-price {
                font-size: 0.9rem;
            }
            
            .original-price {
                font-size: 0.7rem;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 20px;
            }
            
            /* Çok küçük ekranlar için */
            .categories {
                gap: 4px;
            }
            
            .category-btn {
                padding: 4px 8px;
                font-size: 0.7rem;
            }
            
            .sort-select {
                padding: 4px 8px;
                font-size: 0.7rem;
                min-width: 100px;
                margin-left: auto;
            }
            
            .product-badge, .category-badge {
                font-size: 0.6rem;
                padding: 2px 4px;
            }
            
            .remove-favorite-btn {
                width: 20px;
                height: 20px;
                top: 35px;
            }
            
            /* Modal Responsive */
            .modal-overlay {
                padding: 10px;
            }
            
            .modal-content {
                max-width: 95%;
            }
            
            .modal-header {
                padding: 10px 12px;
            }
            
            .category-modal-item {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .category-count {
                font-size: 0.7rem;
                min-width: 35px;
            }
        }

        @media (max-width: 360px) {
            .products-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .header-content {
                gap: 6px;
            }
            
            .logo {
                font-size: 0.9rem;
            }
            
            .hero h1 {
                font-size: 1.1rem;
            }
            
            .hero p {
                font-size: 0.8rem;
            }
            
            .categories {
                gap: 3px;
            }
            
            .category-btn, .sort-select {
                font-size: 0.65rem;
                padding: 3px 6px;
            }
            
            .sort-select {
                min-width: 90px;
                margin-left: auto;
            }
        }

        /* Touch device improvements */
        @media (hover: none) {
            .product-card:hover {
                transform: none;
            }
            
            .product-card:hover .remove-favorite-btn {
                opacity: 1;
            }
            
            .wishlist-btn:hover, .share-btn:hover,
            .pagination-btn:hover, .filter-btn:hover,
            .category-btn:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">İndirim kodu kopyalandı!</span>
    </div>

    <!-- Copy Message -->
    <div id="copyMsg" class="copy-msg">Kupon kopyalandı ✅</div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-bolt"></i>
                    <span data-translate="siteTitle">Budget Buddy</span>
                </div>
                <div class="header-actions">
                    <div class="search-bar">
                        <input type="text" id="search-input" placeholder="Ürün ara..." data-translate="searchPlaceholder">
                        <button id="search-btn"><i class="fas fa-search"></i></button>
                    </div>
                    <button class="theme-toggle" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                        <span data-translate="darkMode">Koyu</span>
                    </button>
                    <div class="language-selector">
                        <button class="language-btn" id="language-btn">
                            <i class="fas fa-globe"></i>
                            <span id="current-language">TR</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="language-dropdown" id="language-dropdown">
                            <!-- Languages will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1 data-translate="heroTitle">En İyi AliExpress İndirimleri</h1>
            <p data-translate="heroSubtitle">Günlük indirim kodları ile en popüler ürünleri keşfedin!</p>
        </div>
    </section>

    <div class="container">
        <!-- Status Info -->
        <div class="status-info" id="status-info">
            <h3><i class="fas fa-sync-alt fa-spin"></i> <span data-translate="loadingProducts">Ürünler Yükleniyor</span>...</h3>
            <p data-translate="loadingDescription">Excel dosyasından ürün bilgileri alınıyor. Lütfen bekleyin.</p>
        </div>

        <!-- Main Content -->
        <div id="main-content" style="display: none;">
            <!-- Categories - Tüm Kategoriler, Favoriler ve Sırala butonları -->
            <div class="categories" id="categories">
                <button class="category-btn active" data-category="all" id="all-categories-btn">
                    <i class="fas fa-th-large"></i> <span data-translate="allCategories">Tüm Kategoriler</span> (<span id="all-categories-count">0</span>)
                </button>
                <button class="category-btn" data-filter="favorites" id="favorites-filter-btn">
                    <i class="fas fa-heart"></i> <span data-translate="filterFavorites">Favoriler</span> (<span id="favorites-count-badge">0</span>)
                </button>
                <select class="sort-select" id="sort-select">
                    <option value="default" data-translate="sortDefault">Sırala</option>
                    <option value="price-low" data-translate="sortPriceLow">Fiyat ↑</option>
                    <option value="price-high" data-translate="sortPriceHigh">Fiyat ↓</option>
                    <option value="discount" data-translate="sortDiscount">İndirim</option>
                    <option value="rating" data-translate="sortRating">Puan</option>
                </select>
            </div>

            <!-- Favorites Management -->
            <div class="favorites-management" id="favorites-management">
                <div id="favorites-count" data-translate="favoritesCount">
                    Toplam 0 favori ürün
                </div>
                <button class="clear-favorites-btn" id="clear-all-favorites" data-translate="clearAllFavorites">
                    Tüm Favorileri Temizle
                </button>
            </div>

            <!-- Products Grid -->
            <div id="products" class="products-grid"></div>

            <!-- Loading Indicator -->
            <div class="loading" id="loading-indicator">
                <div class="loading-spinner"></div>
                <p data-translate="loadingMore">Daha fazla ürün yükleniyor...</p>
            </div>

            <!-- End of Results -->
            <div class="end-of-results" id="end-of-results">
                <i class="fas fa-flag-checkered"></i>
                <h3 data-translate="endOfResultsTitle">Tüm ürünleri görüntülediniz!</h3>
                <p data-translate="endOfResultsDescription">Listelenen tüm ürünleri görüntülediniz. Daha fazla sonuç için farklı bir kategori veya filtre deneyebilirsiniz.</p>
            </div>

            <!-- No Favorites Message -->
            <div class="no-favorites" id="no-favorites">
                <i class="far fa-heart"></i>
                <h3 data-translate="noFavoritesTitle">Henüz favori ürününüz yok</h3>
                <p data-translate="noFavoritesDescription">Beğendiğiniz ürünlerin yanındaki kalp ikonuna tıklayarak favorilere ekleyebilirsiniz.</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 data-translate="footerAbout">AliExpress İndirim</h3>
                    <p data-translate="footerDescription">En iyi AliExpress ürünlerini en uygun fiyatlarla bulabileceğiniz platform.</p>
                </div>
                <div class="footer-section">
                    <h3 data-translate="footerLinks">Hızlı Bağlantılar</h3>
                    <ul>
                        <li><a href="#" data-translate="footerHome">Ana Sayfa</a></li>
                        <li><a href="#" data-translate="footerPopular">Popüler</a></li>
                        <li><a href="#" data-translate="footerNew">Yeni</a></li>
                        <li><a href="#" data-translate="footerContact">İletişim</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3 data-translate="footerHelp">Yardım</h3>
                    <ul>
                        <li><a href="#" data-translate="footerFAQ">SSS</a></li>
                        <li><a href="#" data-translate="footerShipping">Kargo</a></li>
                        <li><a href="#" data-translate="footerReturn">İade</a></li>
                        <li><a href="#" data-translate="footerPrivacy">Gizlilik</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 AliExpress İndirim. <span data-translate="footerRights">Tüm hakları saklıdır.</span>
            </div>
        </div>
    </footer>

    <!-- Categories Modal -->
    <div class="modal-overlay" id="categories-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-translate="allCategoriesModal">Tüm Kategoriler</h3>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <ul class="categories-modal-list" id="categories-modal-list">
                    <!-- Kategoriler JavaScript ile eklenecek -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-header">
                <h3 class="confirmation-title" data-translate="confirmationTitle">Emin misiniz?</h3>
                <button class="confirmation-close" id="confirmation-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="confirmation-body">
                <p class="confirmation-message" data-translate="confirmationMessage">Tüm favori ürünlerinizi temizlemek istediğinizden emin misiniz? Bu işlem geri alınamaz.</p>
                <div class="confirmation-actions">
                    <button class="cancel-btn" id="cancel-clear" data-translate="cancelButton">Hayır</button>
                    <button class="confirm-btn" id="confirm-clear" data-translate="confirmButton">Evet</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Çeviriler - Mobil için kısaltılmış
        const translations = {
            tr: {
                siteTitle: "Budget Buddy",
                searchPlaceholder: "Ara...",
                heroTitle: "En İyi İndirimler",
                heroSubtitle: "Günlük indirim kodları ile popüler ürünler!",
                loadingProducts: "Yükleniyor",
                loadingDescription: "Ürünler hazırlanıyor...",
                clearAllFavorites: "Tümünü Temizle",
                favoritesCount: "{count} favori",
                allCategories: "Tüm Kategoriler",
                allCategoriesModal: "Tüm Kategoriler",
                filterAll: "Tümü",
                filterFavorites: "Favoriler",
                sortDefault: "Sırala",
                sortPriceLow: "Fiyat ↑",
                sortPriceHigh: "Fiyat ↓",
                sortDiscount: "İndirim",
                sortRating: "Puan",
                noFavoritesTitle: "Favori yok",
                noFavoritesDescription: "Ürünleri favorilere ekleyin.",
                loadingMore: "Daha fazla ürün yükleniyor...",
                endOfResultsTitle: "Tüm ürünleri görüntülediniz!",
                endOfResultsDescription: "Listelenen tüm ürünleri görüntülediniz. Daha fazla sonuç için farklı bir kategori veya filtre deneyebilirsiniz.",
                footerAbout: "AliExpress",
                footerDescription: "En iyi ürünler uygun fiyatlarla.",
                footerLinks: "Bağlantılar",
                footerHome: "Ana Sayfa",
                footerPopular: "Popüler",
                footerNew: "Yeni",
                footerContact: "İletişim",
                footerHelp: "Yardım",
                footerFAQ: "SSS",
                footerShipping: "Kargo",
                footerReturn: "İade",
                footerPrivacy: "Gizlilik",
                footerRights: "Tüm hakları saklıdır.",
                codeCopied: "Kopyalandı:",
                addedToFavorites: "Favorilere eklendi",
                removedFromFavorites: "Favorilerden çıkarıldı",
                allFavoritesCleared: "Tüm favoriler temizlendi",
                shareText: "Bu ürünü inceleyin!",
                darkMode: "Koyu",
                lightMode: "Açık",
                noProductsFound: "Ürün bulunamadı.",
                discountCode: "Kod:",
                buyNow: "Satın Al",
                confirmationTitle: "Emin misiniz?",
                confirmationMessage: "Tüm favori ürünlerinizi temizlemek istediğinizden emin misiniz? Bu işlem geri alınamaz.",
                cancelButton: "Hayır",
                confirmButton: "Evet"
            },
            en: {
                siteTitle: "Budget Buddy",
                searchPlaceholder: "Search...",
                heroTitle: "Best Discounts",
                heroSubtitle: "Daily discount codes for popular products!",
                loadingProducts: "Loading",
                loadingDescription: "Products preparing...",
                clearAllFavorites: "Clear All",
                favoritesCount: "{count} favorites",
                allCategories: "All Categories",
                allCategoriesModal: "All Categories",
                filterAll: "All",
                filterFavorites: "Favorites",
                sortDefault: "Sort",
                sortPriceLow: "Price ↑",
                sortPriceHigh: "Price ↓",
                sortDiscount: "Discount",
                sortRating: "Rating",
                noFavoritesTitle: "No Favorites",
                noFavoritesDescription: "Add products to favorites.",
                loadingMore: "Loading more products...",
                endOfResultsTitle: "You've viewed all products!",
                endOfResultsDescription: "You've viewed all listed products. Try a different category or filter for more results.",
                footerAbout: "AliExpress",
                footerDescription: "Best products at affordable prices.",
                footerLinks: "Links",
                footerHome: "Home",
                footerPopular: "Popular",
                footerNew: "New",
                footerContact: "Contact",
                footerHelp: "Help",
                footerFAQ: "FAQ",
                footerShipping: "Shipping",
                footerReturn: "Return",
                footerPrivacy: "Privacy",
                footerRights: "All rights reserved.",
                codeCopied: "Copied:",
                addedToFavorites: "Added to favorites",
                removedFromFavorites: "Removed from favorites",
                allFavoritesCleared: "All favorites cleared",
                shareText: "Check this product!",
                darkMode: "Dark",
                lightMode: "Light",
                noProductsFound: "No products found.",
                discountCode: "Code:",
                buyNow: "Buy Now",
                confirmationTitle: "Are you sure?",
                confirmationMessage: "Are you sure you want to clear all your favorite products? This action cannot be undone.",
                cancelButton: "No",
                confirmButton: "Yes"
            },
            es: {
                siteTitle: "Budget Buddy",
                searchPlaceholder: "Buscar...",
                heroTitle: "Mejores Descuentos",
                heroSubtitle: "¡Códigos de descuento diarios!",
                loadingProducts: "Cargando",
                loadingDescription: "Productos preparándose...",
                clearAllFavorites: "Limpiar Todo",
                favoritesCount: "{count} favoritos",
                allCategories: "Todas las Categorías",
                allCategoriesModal: "Todas las Categorías",
                filterAll: "Todos",
                filterFavorites: "Favoritos",
                sortDefault: "Ordenar",
                sortPriceLow: "Precio ↑",
                sortPriceHigh: "Precio ↓",
                sortDiscount: "Descuento",
                sortRating: "Puntuación",
                noFavoritesTitle: "Sin Favoritos",
                noFavoritesDescription: "Agrega productos a favoritos.",
                loadingMore: "Cargando más productos...",
                endOfResultsTitle: "¡Has visto todos los productos!",
                endOfResultsDescription: "Has visto todos los productos listados. Prueba una categoría o filtro diferente para más resultados.",
                footerAbout: "AliExpress",
                footerDescription: "Mejores productos a precios asequibles.",
                footerLinks: "Enlaces",
                footerHome: "Inicio",
                footerPopular: "Popular",
                footerNew: "Nuevo",
                footerContact: "Contacto",
                footerHelp: "Ayuda",
                footerFAQ: "FAQ",
                footerShipping: "Envío",
                footerReturn: "Devolución",
                footerPrivacy: "Privacidad",
                footerRights: "Todos los derechos reservados.",
                codeCopied: "Copiado:",
                addedToFavorites: "Agregado a favoritos",
                removedFromFavorites: "Eliminado de favoritos",
                allFavoritesCleared: "Todos los favoritos eliminados",
                shareText: "¡Mira este producto!",
                darkMode: "Oscuro",
                lightMode: "Claro",
                noProductsFound: "No se encontraron productos.",
                discountCode: "Código:",
                buyNow: "Comprar",
                confirmationTitle: "¿Estás seguro?",
                confirmationMessage: "¿Estás seguro de que quieres eliminar todos tus productos favoritos? Esta acción no se puede deshacer.",
                cancelButton: "No",
                confirmButton: "Sí"
            },
            fr: {
                siteTitle: "Budget Buddy",
                searchPlaceholder: "Rechercher...",
                heroTitle: "Meilleures Promotions",
                heroSubtitle: "Codes de réduction quotidiens !",
                loadingProducts: "Chargement",
                loadingDescription: "Produits en préparation...",
                clearAllFavorites: "Tout Effacer",
                favoritesCount: "{count} favoris",
                allCategories: "Toutes les Catégories",
                allCategoriesModal: "Toutes les Catégories",
                filterAll: "Tous",
                filterFavorites: "Favoris",
                sortDefault: "Trier",
                sortPriceLow: "Prix ↑",
                sortPriceHigh: "Prix ↓",
                sortDiscount: "Réduction",
                sortRating: "Note",
                noFavoritesTitle: "Aucun Favori",
                noFavoritesDescription: "Ajoutez des produits aux favoris.",
                loadingMore: "Chargement de plus de produits...",
                endOfResultsTitle: "Vous avez vu tous les produits !",
                endOfResultsDescription: "Vous avez vu tous les produits listés. Essayez une catégorie ou un filtre différent pour plus de résultats.",
                footerAbout: "AliExpress",
                footerDescription: "Meilleurs produits à prix abordables.",
                footerLinks: "Liens",
                footerHome: "Accueil",
                footerPopular: "Populaire",
                footerNew: "Nouveau",
                footerContact: "Contact",
                footerHelp: "Aide",
                footerFAQ: "FAQ",
                footerShipping: "Livraison",
                footerReturn: "Retour",
                footerPrivacy: "Confidentialité",
                footerRights: "Tous droits réservés.",
                codeCopied: "Copié :",
                addedToFavorites: "Ajouté aux favoris",
                removedFromFavorites: "Retiré des favoris",
                allFavoritesCleared: "Tous les favoris effacés",
                shareText: "Découvrez ce produit !",
                darkMode: "Sombre",
                lightMode: "Clair",
                noProductsFound: "Aucun produit trouvé.",
                discountCode: "Code :",
                buyNow: "Acheter",
                confirmationTitle: "Êtes-vous sûr ?",
                confirmationMessage: "Êtes-vous sûr de vouloir supprimer tous vos produits favoris ? Cette action ne peut pas être annulée.",
                cancelButton: "Non",
                confirmButton: "Oui"
            }
        };

        // Global değişkenler
        let allProducts = [];
        let displayedProducts = 0;
        const productsPerPage = 50;
        let currentFilter = 'all';
        let currentCategory = 'all';
        let currentSort = 'default';
        let isLoading = false;
        let hasMoreProducts = true;
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let currentLanguage = localStorage.getItem('language') || 'tr';
        let currentTheme = localStorage.getItem('theme') || 'dark';
        
        // Sonsuz scroll değişkenleri
        let filteredProducts = [];
        let currentDisplayedCount = 0;

        // DOM Elements
        const productsGrid = document.getElementById('products');
        const statusInfo = document.getElementById('status-info');
        const mainContent = document.getElementById('main-content');
        const loadingIndicator = document.getElementById('loading-indicator');
        const categoriesContainer = document.getElementById('categories');
        const favoritesManagement = document.getElementById('favorites-management');
        const noFavorites = document.getElementById('no-favorites');
        const endOfResults = document.getElementById('end-of-results');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const copyMsg = document.getElementById('copyMsg');
        
        // Modal Elements
        const categoriesModal = document.getElementById('categories-modal');
        const categoriesModalList = document.getElementById('categories-modal-list');
        const modalClose = document.getElementById('modal-close');
        const allCategoriesBtn = document.getElementById('all-categories-btn');
        const favoritesFilterBtn = document.getElementById('favorites-filter-btn');

        // Confirmation Modal Elements
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmationClose = document.getElementById('confirmation-close');
        const cancelClearBtn = document.getElementById('cancel-clear');
        const confirmClearBtn = document.getElementById('confirm-clear');

        // Excel URL
        const EXCEL_FILE_URL = './data3.xls';

        // AliExpress Kategorileri ve Anahtar Kelimeleri
        const categoryKeywords = {
            'Automotive & Motorcycle': [
                'car', 'auto', 'automotive', 'motorcycle', 'bike', 'vehicle', 'tire', 'wheel', 'engine', 
                'brake', 'exhaust', 'headlight', 'taillight', 'mirror', 'seat', 'helmet', 'gloves', 
                'jacket', 'oil', 'filter', 'battery', 'charger', 'tool', 'accessory', 'parts', 'gps',
                'dash cam', 'car camera', 'car audio', 'speaker', 'subwoofer', 'amplifier', 'alarm',
                'lock', 'cover', 'mat', 'cleaner', 'polish', 'wax', 'detailing', 'maintenance'
            ],
            'Beauty & Health': [
                'makeup', 'cosmetic', 'skincare', 'beauty', 'health', 'facial', 'cream', 'lotion', 
                'serum', 'moisturizer', 'cleanser', 'toner', 'mask', 'makeup brush', 'palette', 
                'lipstick', 'mascara', 'eyeshadow', 'foundation', 'concealer', 'blush', 'highlighter',
                'perfume', 'fragrance', 'deodorant', 'shampoo', 'conditioner', 'hair care', 'styling',
                'hair dryer', 'straightener', 'curler', 'trimmer', 'shaver', 'epilator', 'massager',
                'scale', 'thermometer', 'blood pressure', 'fitness', 'vitamin', 'supplement'
            ],
            'Phones & Telecommunications': [
                'smartphone', 'phone', 'mobile', 'iphone', 'samsung', 'huawei', 'xiaomi', 'oppo', 
                'vivo', 'oneplus', 'android', 'ios', '5g', '4g', 'case', 'cover', 'screen protector',
                'charger', 'cable', 'adapter', 'power bank', 'headphone', 'earphone', 'earbud', 
                'bluetooth', 'wireless', 'smartwatch', 'watch', 'tablet', 'ipad', 'accessory',
                'sim card', 'router', 'modem', 'antenna', 'repeater', 'telecommunication'
            ],
            'Home Improvement & Lighting': [
                'home improvement', 'lighting', 'lamp', 'light', 'led', 'bulb', 'fixture', 'ceiling',
                'wall', 'floor', 'desk', 'outdoor', 'garden', 'solar', 'motion', 'sensor', 'switch',
                'outlet', 'extension', 'cord', 'tool', 'drill', 'saw', 'hammer', 'screwdriver',
                'wrench', 'pliers', 'tape', 'measure', 'level', 'paint', 'brush', 'roller', 'toolbox',
                'ladder', 'safety', 'workwear', 'storage', 'shelf', 'rack', 'organization'
            ],
            'Jewelry, Watches & Accessories': [
                'jewelry', 'watch', 'accessory', 'necklace', 'bracelet', 'ring', 'earring', 'pendant',
                'chain', 'bangle', 'anklet', 'brooch', 'cufflink', 'tie clip', 'money clip', 'keychain',
                'sunglasses', 'glasses', 'case', 'luxury', 'fashion', 'diamond', 'gold', 'silver',
                'platinum', 'pearl', 'crystal', 'gemstone', 'birthstone', 'engraving', 'personalized',
                'smart watch', 'fitness tracker', 'activity band', 'watch band', 'strap'
            ],
            'Women\'s Clothing': [
                'women', 'clothing', 'dress', 'skirt', 'blouse', 'shirt', 'top', 't-shirt', 'sweater',
                'cardigan', 'jacket', 'coat', 'hoodie', 'sweatshirt', 'pants', 'jeans', 'leggings',
                'shorts', 'jumpsuit', 'romper', 'lingerie', 'bra', 'panties', 'shapewear', 'swimwear',
                'bikini', 'swimsuit', 'cover up', 'activewear', 'yoga', 'fitness', 'workout', 'socks',
                'tights', 'stockings', 'maternity', 'plus size', 'petite', 'fashion', 'trendy'
            ],
            'Electronics': [
                'electronics', 'electronic', 'gadget', 'device', 'tech', 'technology', 'smart', 'home',
                'audio', 'video', 'tv', 'television', 'monitor', 'display', 'projector', 'speaker',
                'soundbar', 'headphone', 'earphone', 'microphone', 'camera', 'lens', 'drone', 'action',
                'gopro', 'tripod', 'gimbal', 'stabilizer', 'computer', 'laptop', 'tablet', 'printer',
                'scanner', 'keyboard', 'mouse', 'webcam', 'router', 'nas', 'storage', 'hard drive'
            ],
            'Men\'s Clothing': [
                'men', 'clothing', 'shirt', 't-shirt', 'polo', 'button down', 'dress shirt', 'casual',
                'sweater', 'hoodie', 'sweatshirt', 'jacket', 'coat', 'blazer', 'suit', 'pants', 'jeans',
                'chinos', 'shorts', 'swimwear', 'trunks', 'underwear', 'boxers', 'briefs', 'socks',
                'tie', 'belt', 'wallet', 'accessory', 'workwear', 'uniform', 'activewear', 'fitness',
                'outdoor', 'hiking', 'fishing', 'hunting', 'formal', 'business', 'casual', 'streetwear'
            ],
            'Home & Garden': [
                'home', 'garden', 'furniture', 'decor', 'decoration', 'accessory', 'kitchen', 'bath',
                'bedroom', 'living', 'dining', 'outdoor', 'patio', 'lawn', 'plant', 'flower', 'pot',
                'vase', 'candle', 'diffuser', 'wall art', 'picture', 'frame', 'clock', 'mirror',
                'rug', 'carpet', 'mat', 'curtain', 'blind', 'shade', 'pillow', 'cushion', 'blanket',
                'throw', 'bedding', 'sheet', 'duvet', 'comforter', 'quilt', 'towel', 'bath mat'
            ],
            'Toys & Games': [
                'toy', 'game', 'kids', 'children', 'baby', 'educational', 'learning', 'development',
                'puzzle', 'building', 'block', 'lego', 'brick', 'doll', 'action figure', 'vehicle',
                'car', 'truck', 'plane', 'train', 'robot', 'rc', 'remote control', 'drone', 'helicopter',
                'board game', 'card game', 'puzzle game', 'video game', 'console', 'controller',
                'vr', 'virtual reality', 'outdoor', 'playground', 'swing', 'slide', 'trampoline'
            ],
            'Luggage, Bags & Shoes': [
                'luggage', 'bag', 'shoe', 'travel', 'suitcase', 'backpack', 'handbag', 'purse',
                'wallet', 'briefcase', 'messenger', 'tote', 'duffel', 'garment', 'cosmetic', 'laptop',
                'sneaker', 'athletic', 'running', 'walking', 'hiking', 'boot', 'dress', 'casual',
                'sandals', 'flip flop', 'slipper', 'heel', 'pump', 'flat', 'loafer', 'oxford',
                'accessory', 'organizer', 'packing', 'travel gear', 'luggage tag', 'lock'
            ],
            'Furniture': [
                'furniture', 'furnishing', 'table', 'desk', 'chair', 'sofa', 'couch', 'loveseat',
                'sectional', 'recliner', 'ottoman', 'bench', 'stool', 'bed', 'mattress', 'headboard',
                'dresser', 'chest', 'wardrobe', 'armoire', 'cabinet', 'shelf', 'bookcase', 'entertainment',
                'tv stand', 'console', 'coffee', 'end', 'nightstand', 'dining', 'kitchen', 'bar',
                'counter', 'island', 'patio', 'garden', 'outdoor', 'office', 'ergonomic', 'gaming'
            ],
            'Computer, Office & Education': [
                'computer', 'office', 'education', 'laptop', 'desktop', 'monitor', 'keyboard', 'mouse',
                'printer', 'scanner', 'copier', 'fax', 'projector', 'screen', 'whiteboard', 'desk',
                'chair', 'filing', 'cabinet', 'shelf', 'organizer', 'supply', 'pen', 'pencil', 'marker',
                'highlighter', 'notebook', 'binder', 'folder', 'calculator', 'ruler', 'stapler',
                'staple', 'tape', 'glue', 'scissors', 'educational', 'learning', 'teaching', 'science'
            ],
            'Hair Extensions & Wigs': [
                'hair', 'extension', 'wig', 'toupee', 'weave', 'clip-in', 'tape-in', 'fusion',
                'micro', 'strand', 'bundle', 'closure', 'frontal', 'lace', 'synthetic', 'human',
                'remy', 'virgin', 'straight', 'wavy', 'curly', 'kinky', 'color', 'dye', 'highlight',
                'ombre', 'balayage', 'styling', 'care', 'shampoo', 'conditioner', 'treatment',
                'brush', 'comb', 'dryer', 'iron', 'curler', 'accessory', 'cap', 'stand'
            ],
            'Sports & Entertainment': [
                'sports', 'entertainment', 'fitness', 'exercise', 'workout', 'gym', 'yoga', 'pilates',
                'running', 'walking', 'hiking', 'camping', 'fishing', 'hunting', 'cycling', 'biking',
                'swimming', 'diving', 'surfing', 'skiing', 'snowboarding', 'skateboarding', 'roller',
                'team', 'soccer', 'basketball', 'football', 'baseball', 'tennis', 'golf', 'badminton',
                'music', 'instrument', 'guitar', 'piano', 'keyboard', 'drum', 'violin', 'microphone',
                'karaoke', 'dj', 'lighting', 'effect', 'party', 'event', 'game', 'console'
            ],
            'Baby & Maternity': [
                'baby', 'maternity', 'infant', 'toddler', 'child', 'newborn', 'pregnancy', 'mother',
                'nursery', 'crib', 'bassinet', 'bed', 'mattress', 'changing', 'table', 'dresser',
                'storage', 'organizer', 'stroller', 'pram', 'carrier', 'sling', 'car seat', 'high chair',
                'booster', 'bath', 'tub', 'toy', 'educational', 'development', 'clothing', 'onesie',
                'romper', 'sleepwear', 'blanket', 'swaddle', 'feeding', 'bottle', 'pacifier', 'health'
            ],
            'Plus Sized Clothing': [
                'plus size', 'plus sized', 'curvy', 'big', 'tall', 'women', 'men', 'clothing',
                'dress', 'top', 'blouse', 'shirt', 't-shirt', 'sweater', 'cardigan', 'jacket',
                'coat', 'hoodie', 'sweatshirt', 'pants', 'jeans', 'leggings', 'shorts', 'skirt',
                'jumpsuit', 'romper', 'lingerie', 'bra', 'panties', 'shapewear', 'swimwear',
                'activewear', 'fitness', 'workout', 'fashion', 'trendy', 'stylish', 'comfort'
            ],
            'Pet Supplies': [
                'pet', 'supply', 'dog', 'cat', 'puppy', 'kitten', 'food', 'treat', 'snack', 'bowl',
                'feeder', 'waterer', 'fountain', 'bed', 'mat', 'crate', 'cage', 'carrier', 'house',
                'shelter', 'toy', 'chew', 'bone', 'ball', 'frisbee', 'leash', 'collar', 'harness',
                'clothing', 'costume', 'grooming', 'brush', 'comb', 'shampoo', 'conditioner', 'health',
                'vitamin', 'supplement', 'medicine', 'first aid', 'cleaning', 'litter', 'box', 'training'
            ]
        };

        // Event Listeners
        document.getElementById('search-btn').addEventListener('click', performSearch);
        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });

        document.getElementById('sort-select').addEventListener('change', handleSortChange);
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        document.getElementById('language-btn').addEventListener('click', toggleLanguageDropdown);
        document.getElementById('clear-all-favorites').addEventListener('click', showConfirmationModal);
        
        // Sonsuz scroll için event listener
        window.addEventListener('scroll', handleScroll);
        
        // Modal Event Listeners
        allCategoriesBtn.addEventListener('click', openCategoriesModal);
        modalClose.addEventListener('click', closeCategoriesModal);
        categoriesModal.addEventListener('click', function(e) {
            if (e.target === categoriesModal) {
                closeCategoriesModal();
            }
        });
        
        // Confirmation Modal Event Listeners
        confirmationClose.addEventListener('click', closeConfirmationModal);
        cancelClearBtn.addEventListener('click', closeConfirmationModal);
        confirmClearBtn.addEventListener('click', clearAllFavorites);
        confirmationModal.addEventListener('click', function(e) {
            if (e.target === confirmationModal) {
                closeConfirmationModal();
            }
        });
        
        // ESC tuşu ile modal kapatma
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (categoriesModal.classList.contains('show')) {
                    closeCategoriesModal();
                }
                if (confirmationModal.classList.contains('show')) {
                    closeConfirmationModal();
                }
            }
        });

        // Sayfa dışına tıklanınca dropdown'ı kapat
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.language-selector')) {
                document.getElementById('language-dropdown').classList.remove('show');
            }
        });

        // Tema değiştirme
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            updateThemeButton();
        }

        function updateThemeButton() {
            const icon = document.querySelector('#theme-toggle i');
            const text = document.querySelector('#theme-toggle span');
            if (currentTheme === 'dark') {
                icon.className = 'fas fa-sun';
                text.setAttribute('data-translate', 'lightMode');
            } else {
                icon.className = 'fas fa-moon';
                text.setAttribute('data-translate', 'darkMode');
            }
            updatePageLanguage();
        }

        // Dil değiştirme
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            document.getElementById('current-language').textContent = lang.toUpperCase();
            updatePageLanguage();
            toggleLanguageDropdown();
            
            // Ürünleri yeniden render et
            if (allProducts.length > 0) {
                filterAndDisplayProducts();
            }
        }

        function toggleLanguageDropdown() {
            document.getElementById('language-dropdown').classList.toggle('show');
        }

        function createLanguageOptions() {
            const languages = [
                { code: 'tr', name: 'Türkçe', flag: '🇹🇷' },
                { code: 'en', name: 'English', flag: '🇺🇸' },
                { code: 'es', name: 'Español', flag: '🇪🇸' },
                { code: 'fr', name: 'Français', flag: '🇫🇷' }
            ];

            const dropdown = document.getElementById('language-dropdown');
            dropdown.innerHTML = languages.map(lang => `
                <div class="language-option" onclick="changeLanguage('${lang.code}')">
                    ${lang.flag} ${lang.name}
                </div>
            `).join('');
        }

        // Sayfa dilini güncelle
        function updatePageLanguage() {
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    let translatedText = translations[currentLanguage][key];
                    
                    // Özel durumlar için değişkenleri değiştir
                    if (key === 'favoritesCount') {
                        translatedText = translatedText.replace('{count}', favorites.length);
                    }
                    
                    if (element.tagName === 'INPUT') {
                        element.placeholder = translatedText;
                    } else if (element.tagName === 'OPTION') {
                        element.textContent = translatedText;
                    } else {
                        element.textContent = translatedText;
                    }
                }
            });
            updateFavoritesCount();
        }

        // Ürün başlığını çevir
        function translateProductTitle(title, targetLang) {
            if (targetLang === 'en') return title;
            
            let translatedTitle = title;
            const titleLower = title.toLowerCase();
            
            const translationMap = productTranslations[targetLang];
            
            const phrases = Object.keys(translationMap)
                .filter(key => key.includes(' ') && titleLower.includes(key))
                .sort((a, b) => b.length - a.length);
            
            for (const phrase of phrases) {
                const regex = new RegExp(phrase, 'gi');
                translatedTitle = translatedTitle.replace(regex, translationMap[phrase]);
            }
            
            const words = Object.keys(translationMap)
                .filter(key => !key.includes(' '))
                .sort((a, b) => b.length - a.length);
            
            for (const word of words) {
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                if (regex.test(translatedTitle.toLowerCase())) {
                    translatedTitle = translatedTitle.replace(regex, translationMap[word]);
                }
            }
            
            return translatedTitle;
        }

        // Toast bildirimi
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Kupon kopyalama mesajı
        function showCopyMsg() {
            copyMsg.style.display = "block";
            setTimeout(() => copyMsg.style.display = "none", 1300);
        }

        // Onay modalını göster
        function showConfirmationModal() {
            if (favorites.length === 0) {
                showToast(currentLanguage === 'tr' ? 'Favori ürün bulunmuyor!' : 'No favorite products found!');
                return;
            }
            confirmationModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // Onay modalını kapat
        function closeConfirmationModal() {
            confirmationModal.classList.remove('show');
            document.body.style.overflow = '';
        }

        // Kategori tahmini yap
        function predictCategory(productTitle) {
            const title = productTitle.toLowerCase();
            
            if (productTitle.category && productTitle.category !== 'Diğer') {
                return productTitle.category;
            }
            
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                for (const keyword of keywords) {
                    if (title.includes(keyword.toLowerCase())) {
                        return category;
                    }
                }
            }
            
            return 'Diğer';
        }

        // Modal açma fonksiyonu
        function openCategoriesModal() {
            // Kategori listesini oluştur
            renderCategoriesModal();
            
            // Modalı göster
            categoriesModal.classList.add('show');
            document.body.style.overflow = 'hidden'; // Sayfa kaydırmayı engelle
        }

        // Modal kapatma fonksiyonu
        function closeCategoriesModal() {
            categoriesModal.classList.remove('show');
            document.body.style.overflow = ''; // Sayfa kaydırmayı geri aç
        }

        // Modal için kategori listesini oluştur
        function renderCategoriesModal() {
            if (!allProducts || allProducts.length === 0) return;
            
            // Kategorileri topla ve sayılarını hesapla
            const categoryCounts = {};
            allProducts.forEach(product => {
                const category = product.category || 'Diğer';
                categoryCounts[category] = (categoryCounts[category] || 0) + 1;
            });
            
            // Tüm kategorileri sırala (sabit sırada)
            const allCategoryList = [
                'all',
                'Automotive & Motorcycle',
                'Beauty & Health', 
                'Phones & Telecommunications',
                'Home Improvement & Lighting',
                'Jewelry, Watches & Accessories',
                'Women\'s Clothing',
                'Electronics',
                'Men\'s Clothing',
                'Home & Garden',
                'Toys & Games',
                'Luggage, Bags & Shoes',
                'Furniture',
                'Computer, Office & Education',
                'Hair Extensions & Wigs',
                'Sports & Entertainment',
                'Baby & Maternity',
                'Plus Sized Clothing',
                'Pet Supplies',
                'Diğer'
            ];
            
            // Modal içeriğini oluştur
            categoriesModalList.innerHTML = allCategoryList.map(category => {
                let count, displayName;
                
                if (category === 'all') {
                    count = allProducts.length;
                    displayName = translations[currentLanguage].allCategories || 'Tüm Kategoriler';
                } else {
                    count = categoryCounts[category] || 0;
                    displayName = category;
                }
                
                const isActive = currentCategory === category;
                
                return `
                    <li class="category-modal-item ${isActive ? 'active' : ''}" 
                        data-category="${category}" 
                        onclick="selectCategoryFromModal('${category}')">
                        <span class="category-name">
                            <i class="fas ${category === 'all' ? 'fa-th-large' : 'fa-tag'}"></i>
                            ${displayName}
                        </span>
                        <span class="category-count">${count}</span>
                    </li>
                `;
            }).join('');
        }

        // Modal'dan kategori seçme
        function selectCategoryFromModal(category) {
            // Kategoriyi seç
            currentCategory = category;
            currentDisplayedCount = 0;
            
            // Tüm Kategoriler butonunu güncelle
            updateAllCategoriesButton();
            
            // Modal'ı kapat
            closeCategoriesModal();
            
            // Favori filtresini kapat
            currentFilter = 'all';
            favoritesManagement.classList.remove('show');
            
            // Tüm Kategoriler butonunu aktif yap
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            allCategoriesBtn.classList.add('active');
            
            // Ürünleri filtrele ve göster
            filterAndDisplayProducts();
        }

        // Tüm Kategoriler butonunu güncelle
        function updateAllCategoriesButton() {
            const count = currentCategory === 'all' 
                ? allProducts.length 
                : allProducts.filter(p => p.category === currentCategory).length;
            
            allCategoriesBtn.innerHTML = `
                <i class="fas fa-th-large"></i> 
                <span data-translate="allCategories">${currentCategory === 'all' ? translations[currentLanguage].allCategories : currentCategory}</span> 
                (${count})
            `;
            
            // Çeviriyi tekrar uygula
            const span = allCategoriesBtn.querySelector('span[data-translate]');
            if (span && translations[currentLanguage]) {
                const key = span.getAttribute('data-translate');
                if (translations[currentLanguage][key]) {
                    span.textContent = currentCategory === 'all' 
                        ? translations[currentLanguage][key] 
                        : currentCategory;
                }
            }
        }

        // Kategori sayısını al
        function getCategoryCount(category) {
            if (category === 'all') return allProducts.length;
            return allProducts.filter(p => p.category === category).length;
        }

        // Excel yükleme
        async function loadExcelFile() {
            try {
                console.log("Excel yükleniyor...");
                
                // Test ürünleri oluştur - Her kategori için örnek ürünler
                const testProducts = [];
                const categories = Object.keys(categoryKeywords);
                
                // Her kategori için 8-10 örnek ürün oluştur
                categories.forEach((category, categoryIndex) => {
                    const categoryKeywordsList = categoryKeywords[category];
                    
                    for (let i = 1; i <= 10; i++) {
                        const productIndex = (categoryIndex * 10) + i;
                        const randomKeyword = categoryKeywordsList[Math.floor(Math.random() * categoryKeywordsList.length)];
                        const discount = Math.floor(Math.random() * 50) + 10;
                        const originalPrice = Math.floor(Math.random() * 1000) + 100;
                        const discountPrice = Math.floor(originalPrice * (100 - discount) / 100);
                        
                        testProducts.push({
                            id: productIndex.toString(),
                            title: `${randomKeyword} ${productIndex} - Premium Quality ${category} Product with Special Features`,
                            image: `https://via.placeholder.com/300x200/${Math.floor(Math.random()*16777215).toString(16)}/FFFFFF?text=${category.replace(/\s+/g, '+')}`,
                            originalPrice: `₺${originalPrice}`,
                            discountPrice: `₺${discountPrice}`,
                            discount: `%${discount}`,
                            code: `CODE${productIndex}`,
                            link: '#',
                            category: category,
                            rating: (Math.random() * 10 + 85).toFixed(0),
                            sales: Math.floor(Math.random() * 2000) + 100
                        });
                    }
                });

                // Gerçek Excel dosyasını yükle
                try {
                    const response = await fetch(EXCEL_FILE_URL);
                    if (response.ok) {
                        const arrayBuffer = await response.arrayBuffer();
                        const data = new Uint8Array(arrayBuffer);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        
                        if (jsonData.length > 0) {
                            allProducts = jsonData.map(item => {
                                const originalTitle = item['Product Desc'] || item.title || 'Ürün';
                                const product = {
                                    id: item.ProductId || Math.random().toString(36).substr(2, 9),
                                    title: originalTitle,
                                    originalTitle: originalTitle,
                                    image: item['Image Url'] || item.image || 'https://via.placeholder.com/300x200/666/FFFFFF?text=Resim+Yok',
                                    originalPrice: item['Origin Price'] || item.originalPrice || '₺0',
                                    discountPrice: item['Discount Price'] || item.discountPrice || '₺0', 
                                    discount: item.Discount || item.discount || '%0',
                                    code: item['Code Name'] || item.code || '',
                                    link: item['Promotion Url'] || item.link || '#',
                                    category: item.Category || item.category || '',
                                    rating: item['Positive Feedback'] || item.rating || '0',
                                    sales: item.Sales180Day || item.sales || '0'
                                };
                                
                                if (!product.category) {
                                    product.category = predictCategory(product.title);
                                }
                                
                                return product;
                            });
                            console.log("Excel'den", allProducts.length, "ürün yüklendi");
                        } else {
                            throw new Error('Excel dosyası boş');
                        }
                    } else {
                        throw new Error('Excel dosyası bulunamadı');
                    }
                } catch (error) {
                    console.log("Excel yüklenemedi, test verileri kullanılıyor:", error.message);
                    allProducts = testProducts.map(product => ({
                        ...product,
                        originalTitle: product.title
                    }));
                }

                processProducts();
                
            } catch (error) {
                console.error("Hata:", error);
                statusInfo.innerHTML = `<h3><i class="fas fa-exclamation-triangle"></i> Hata</h3><p>${error.message}</p>`;
            }
        }

        // Ürünleri işle
        function processProducts() {
            // Tüm Kategoriler, Favoriler ve Sırala butonlarını göster
            categoriesContainer.innerHTML = `
                <button class="category-btn active" data-category="all" id="all-categories-btn">
                    <i class="fas fa-th-large"></i> <span data-translate="allCategories">Tüm Kategoriler</span> (<span id="all-categories-count">${allProducts.length}</span>)
                </button>
                <button class="category-btn" data-filter="favorites" id="favorites-filter-btn">
                    <i class="fas fa-heart"></i> <span data-translate="filterFavorites">Favoriler</span> (<span id="favorites-count-badge">${favorites.length}</span>)
                </button>
                <select class="sort-select" id="sort-select">
                    <option value="default" data-translate="sortDefault">Sırala</option>
                    <option value="price-low" data-translate="sortPriceLow">Fiyat ↑</option>
                    <option value="price-high" data-translate="sortPriceHigh">Fiyat ↓</option>
                    <option value="discount" data-translate="sortDiscount">İndirim</option>
                    <option value="rating" data-translate="sortRating">Puan</option>
                </select>
            `;

            // Tüm Kategoriler butonuna event listener ekle
            document.getElementById('all-categories-btn').addEventListener('click', openCategoriesModal);

            // Favoriler butonuna event listener ekle
            document.getElementById('favorites-filter-btn').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentFilter = 'favorites';
                currentDisplayedCount = 0;
                favoritesManagement.classList.add('show');
                filterAndDisplayProducts();
            });

            statusInfo.style.display = 'none';
            mainContent.style.display = 'block';
            
            filterAndDisplayProducts();
        }

        // Filtrele ve göster
        function filterAndDisplayProducts() {
            filteredProducts = [...allProducts];
            
            // Kategori filtresi
            if (currentCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.category === currentCategory);
            }
            
            // Ana filtreler
            switch(currentFilter) {
                case 'favorites':
                    filteredProducts = filteredProducts.filter(p => favorites.includes(p.id));
                    break;
            }
            
            // Sıralama
            applySorting(filteredProducts);
            
            // İlk 50 ürünü göster
            currentDisplayedCount = 0;
            loadMoreProducts();
        }

        // Sıralama
        function handleSortChange() {
            currentSort = document.getElementById('sort-select').value;
            currentDisplayedCount = 0;
            filterAndDisplayProducts();
        }

        function applySorting(products) {
            switch(currentSort) {
                case 'price-low':
                    products.sort((a, b) => extractPrice(a.discountPrice) - extractPrice(b.discountPrice));
                    break;
                case 'price-high':
                    products.sort((a, b) => extractPrice(b.discountPrice) - extractPrice(a.discountPrice));
                    break;
                case 'discount':
                    products.sort((a, b) => extractDiscount(b.discount) - extractDiscount(a.discount));
                    break;
                case 'rating':
                    products.sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating));
                    break;
            }
            return products;
        }

        function extractPrice(priceStr) {
            const match = priceStr.match(/[\d,]+/);
            return match ? parseFloat(match[0].replace(',', '')) : 0;
        }

        function extractDiscount(discountStr) {
            const match = discountStr.match(/\d+/);
            return match ? parseInt(match[0]) : 0;
        }

        // Daha fazla ürün yükle
        function loadMoreProducts() {
            if (isLoading) return;
            
            const startIndex = currentDisplayedCount;
            const endIndex = Math.min(currentDisplayedCount + productsPerPage, filteredProducts.length);
            
            if (startIndex >= filteredProducts.length) {
                // Tüm ürünler yüklendi
                endOfResults.style.display = 'block';
                loadingIndicator.style.display = 'none';
                return;
            }
            
            isLoading = true;
            loadingIndicator.style.display = 'block';
            endOfResults.style.display = 'none';
            
            // Simüle edilmiş yükleme gecikmesi
            setTimeout(() => {
                const productsToShow = filteredProducts.slice(startIndex, endIndex);
                
                if (currentDisplayedCount === 0) {
                    // İlk yükleme, tüm ürünleri temizle
                    productsGrid.innerHTML = '';
                }
                
                renderProducts(productsToShow);
                
                currentDisplayedCount = endIndex;
                isLoading = false;
                loadingIndicator.style.display = 'none';
                
                // Tüm ürünler yüklendi mi kontrol et
                if (currentDisplayedCount >= filteredProducts.length) {
                    endOfResults.style.display = 'block';
                }
            }, 500);
        }

        // Scroll işleyicisi
        function handleScroll() {
            if (isLoading) return;
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            
            // Sayfanın sonuna yaklaşıldığında daha fazla ürün yükle
            if (scrollTop + windowHeight >= documentHeight - 500) {
                loadMoreProducts();
            }
        }

        // Ürünleri render et
        function renderProducts(products) {
            if (products.length === 0 && currentDisplayedCount === 0) {
                if (currentFilter === 'favorites') {
                    noFavorites.style.display = 'block';
                    productsGrid.style.display = 'none';
                } else {
                    productsGrid.innerHTML = `<p style="grid-column: 1/-1; text-align: center; padding: 40px;">${translations[currentLanguage].noProductsFound}</p>`;
                }
                loadingIndicator.style.display = 'none';
                endOfResults.style.display = 'none';
                return;
            }

            noFavorites.style.display = 'none';
            productsGrid.style.display = 'grid';

            products.forEach(product => {
                const isFavorite = favorites.includes(product.id);
                
                // Ürün başlığını çevir
                const displayTitle = currentLanguage === 'en' 
                    ? product.title 
                    : translateProductTitle(product.originalTitle || product.title, currentLanguage);
                
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image-container" onclick="window.open('${product.link}', '_blank')">
                        <div class="product-badge">${product.discount}</div>
                        <div class="category-badge">${product.category}</div>
                        ${currentFilter === 'favorites' ? `
                        <button class="remove-favorite-btn" onclick="removeFavorite('${product.id}', event)">
                            <i class="fas fa-times"></i>
                        </button>
                        ` : ''}
                        <img src="${product.image}" alt="${displayTitle}" class="product-image" onerror="this.src='https://via.placeholder.com/300x200/666/FFFFFF?text=Resim+Yok'">
                    </div>
                    <div class="product-info">
                        <h3 class="product-title short" onclick="toggleTitle(this)">${displayTitle}</h3>
                        <div class="product-price">
                            <span class="current-price">${product.discountPrice}</span>
                            <span class="original-price">${product.originalPrice}</span>
                            <span class="discount">${product.discount}</span>
                        </div>
                        ${product.code ? `
                        <div class="product-code">
                            <span class="code-label">${translations[currentLanguage].discountCode}</span>
                            <span class="code-value" onclick="copyCode('${product.code}', event)">${product.code}</span>
                        </div>
                        ` : ''}
                        <div class="product-actions">
                            <a href="${product.link}" target="_blank" class="buy-btn">
                                <i class="fas fa-shopping-cart"></i> ${translations[currentLanguage].buyNow}
                            </a>
                            <button class="wishlist-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${product.id}')">
                                <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
                            </button>
                            <button class="share-btn" onclick="shareProduct(${JSON.stringify(product).replace(/"/g, '&quot;')}, event)">
                                <i class="fas fa-share-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
                productsGrid.appendChild(productCard);
            });
        }

        // Ürün başlığını genişlet/daralt
        function toggleTitle(element) {
            if (element.classList.contains('short')) {
                element.classList.remove('short');
                element.classList.add('long');
            } else {
                element.classList.remove('long');
                element.classList.add('short');
            }
        }

        // Favori işlemleri
        function toggleFavorite(productId) {
            const index = favorites.indexOf(productId);
            if (index === -1) {
                favorites.push(productId);
                showToast(translations[currentLanguage].addedToFavorites);
            } else {
                favorites.splice(index, 1);
                showToast(translations[currentLanguage].removedFromFavorites);
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesUI();
            
            if (currentFilter === 'favorites') {
                currentDisplayedCount = 0;
                filterAndDisplayProducts();
            }
        }

        function removeFavorite(productId, event) {
            if (event) event.stopPropagation();
            const index = favorites.indexOf(productId);
            if (index !== -1) {
                favorites.splice(index, 1);
                localStorage.setItem('favorites', JSON.stringify(favorites));
                showToast(translations[currentLanguage].removedFromFavorites);
                updateFavoritesUI();
                
                if (currentFilter === 'favorites') {
                    currentDisplayedCount = 0;
                    filterAndDisplayProducts();
                }
            }
        }

        function clearAllFavorites() {
            if (favorites.length > 0) {
                favorites = [];
                localStorage.setItem('favorites', JSON.stringify(favorites));
                showToast(translations[currentLanguage].allFavoritesCleared);
                updateFavoritesUI();
                closeConfirmationModal();
                
                if (currentFilter === 'favorites') {
                    currentDisplayedCount = 0;
                    filterAndDisplayProducts();
                }
            } else {
                closeConfirmationModal();
                showToast(currentLanguage === 'tr' ? 'Favori ürün bulunmuyor!' : 'No favorite products found!');
            }
        }

        function updateFavoritesUI() {
            updateFavoritesCount();
            
            // Favori sayısını badge'de güncelle
            const favoritesBadge = document.getElementById('favorites-count-badge');
            if (favoritesBadge) {
                favoritesBadge.textContent = favorites.length;
            }
            
            const favoriteButtons = document.querySelectorAll('.wishlist-btn');
            favoriteButtons.forEach(btn => {
                const productCard = btn.closest('.product-card');
                if (productCard) {
                    const productId = getProductIdFromCard(productCard);
                    if (favorites.includes(productId)) {
                        btn.classList.add('active');
                        btn.innerHTML = '<i class="fas fa-heart"></i>';
                    } else {
                        btn.classList.remove('active');
                        btn.innerHTML = '<i class="far fa-heart"></i>';
                    }
                }
            });
        }

        function getProductIdFromCard(card) {
            const wishlistBtn = card.querySelector('.wishlist-btn');
            const onclickAttr = wishlistBtn.getAttribute('onclick');
            const match = onclickAttr.match(/toggleFavorite\('([^']+)'\)/);
            return match ? match[1] : null;
        }

        function updateFavoritesCount() {
            const count = favorites.length;
            const favoritesCountElement = document.getElementById('favorites-count');
            if (translations[currentLanguage]) {
                favoritesCountElement.textContent = 
                    translations[currentLanguage].favoritesCount.replace('{count}', count);
            }
        }

        // Diğer fonksiyonlar
        function performSearch() {
            const term = document.getElementById('search-input').value.toLowerCase().trim();
            if (!term) {
                currentDisplayedCount = 0;
                filterAndDisplayProducts();
                return;
            }
            
            const filtered = allProducts.filter(p => {
                const displayTitle = currentLanguage === 'en' 
                    ? p.title 
                    : translateProductTitle(p.originalTitle || p.title, currentLanguage);
                
                return displayTitle.toLowerCase().includes(term) || 
                       (p.category && p.category.toLowerCase().includes(term));
            });
            
            filteredProducts = filtered;
            currentDisplayedCount = 0;
            loadMoreProducts();
        }

        function copyCode(code, event) {
            if (event) event.stopPropagation();
            navigator.clipboard.writeText(code).then(() => {
                showCopyMsg();
            }).catch(err => {
                showToast(currentLanguage === 'tr' ? 'Kopyalama başarısız!' : 'Copy failed!');
            });
        }

        function shareProduct(product, event) {
            if (event) event.stopPropagation();
            const shareText = translations[currentLanguage].shareText;
            const shareUrl = product.link;
            const discountCode = product.code ? `\n${translations[currentLanguage].discountCode} ${product.code}` : '';
            
            // Çevrilmiş başlık
            const displayTitle = currentLanguage === 'en' 
                ? product.title 
                : translateProductTitle(product.originalTitle || product.title, currentLanguage);
            
            if (navigator.share) {
                navigator.share({
                    title: displayTitle,
                    text: `${shareText}${discountCode}`,
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(`${displayTitle} - ${shareUrl}${discountCode}`);
                showToast(currentLanguage === 'tr' ? 'Ürün bilgileri kopyalandı!' : 'Product information copied!');
            }
        }

        // Sayfa yüklendiğinde
        window.addEventListener('DOMContentLoaded', () => {
            console.log("Sayfa yüklendi");
            
            // Temayı yükle
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            currentTheme = savedTheme;
            updateThemeButton();
            
            // Dili yükle
            const savedLanguage = localStorage.getItem('language') || 'tr';
            currentLanguage = savedLanguage;
            document.getElementById('current-language').textContent = savedLanguage.toUpperCase();
            
            createLanguageOptions();
            updatePageLanguage();
            loadExcelFile();
        });

        // Global fonksiyonlar
        window.changeLanguage = changeLanguage;
        window.toggleFavorite = toggleFavorite;
        window.removeFavorite = removeFavorite;
        window.copyCode = copyCode;
        window.shareProduct = shareProduct;
        window.toggleTitle = toggleTitle;
        window.openCategoriesModal = openCategoriesModal;
        window.closeCategoriesModal = closeCategoriesModal;
        window.selectCategoryFromModal = selectCategoryFromModal;
        window.showConfirmationModal = showConfirmationModal;
        window.closeConfirmationModal = closeConfirmationModal;

        // Ürün çevirileri
        const productTranslations = {
            en: {},
            tr: {},
            es: {},
            fr: {}
        };
    </script>
</body>
</html>
