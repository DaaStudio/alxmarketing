<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programatik Video Olu≈üturucu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .product-card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            background: white;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .product-image {
            height: 200px;
            object-fit: contain;
            background: #f8f9fa;
            padding: 10px;
            width: 100%;
        }
        
        .discount-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 1;
        }
        
        .price-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #888;
            font-size: 14px;
        }
        
        .discount-price {
            color: var(--danger-color);
            font-size: 24px;
            font-weight: bold;
        }
        
        .video-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        #videoCanvas {
            display: none;
            max-width: 100%;
            margin: 20px auto;
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        #videoPreview {
            max-width: 100%;
            margin: 20px auto;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }
        
        .product-title {
            font-size: 14px;
            height: 60px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress {
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99999;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .video-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .video-template-card {
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .video-template-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }
        
        .video-template-card.active {
            border-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.1);
        }
        
        .template-preview {
            height: 120px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .social-media-btn {
            margin: 5px;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .social-media-btn:hover {
            transform: scale(1.05);
        }
        
        .btn-instagram {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
            color: white;
            border: none;
        }
        
        .btn-twitter {
            background: #1DA1F2;
            color: white;
            border: none;
        }
        
        .btn-facebook {
            background: #1877F2;
            color: white;
            border: none;
        }
        
        .btn-tiktok {
            background: #000000;
            color: white;
            border: none;
        }
        
        .audio-options {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- Y√ºkleme Ekranƒ± -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Y√ºkleniyor...</span>
            </div>
            <h4 class="mt-3" id="loadingTitle">Video Olu≈üturuluyor</h4>
            <div class="progress mt-3">
                <div id="loadingProgress" class="progress-bar progress-bar-striped progress-bar-animated" 
                     role="progressbar" style="width: 0%"></div>
            </div>
            <p id="loadingText" class="mt-2">Hazƒ±rlanƒ±yor...</p>
        </div>
    </div>
    
    <div class="container py-5">
        <!-- Ba≈ülƒ±k -->
        <div class="text-center mb-5">
            <h1 class="text-white fw-bold mb-3">
                <i class="fas fa-film me-2"></i>Programatik Video Olu≈üturucu
            </h1>
            <p class="text-white lead">Excel dosyasƒ±ndan √ºr√ºnleri oku, otomatik video olu≈ütur ve indir!</p>
        </div>
        
        <!-- √úr√ºn Grid -->
        <div id="productsGrid" class="row">
            <!-- √úr√ºnler buraya y√ºklenecek -->
        </div>
        
        <!-- Video Olu≈üturma Alanƒ± -->
        <div id="videoCreationArea" class="video-container">
            <button id="backButton" class="btn btn-outline-secondary mb-3" onclick="goBackToProducts()">
                <i class="fas fa-arrow-left me-2"></i>√úr√ºnlere Geri D√∂n
            </button>
            
            <h3 class="text-center mb-4">Video Ayarlarƒ±</h3>
            
            <!-- Video ≈ûablonlarƒ± -->
            <div class="mb-4">
                <h5>Video ≈ûablonu Se√ßin:</h5>
                <div class="row" id="videoTemplates">
                    <!-- ≈ûablonlar buraya eklenecek -->
                </div>
            </div>
            
            <!-- Ses Efektleri -->
            <div class="audio-options">
                <h5>Ses Efektleri:</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="addBackgroundMusic" checked>
                            <label class="form-check-label" for="addBackgroundMusic">
                                Arka Plan M√ºziƒüi Ekle
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="addSoundEffects" checked>
                            <label class="form-check-label" for="addSoundEffects">
                                Ses Efektleri Ekle
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="musicStyle">M√ºzik Stili:</label>
                        <select id="musicStyle" class="form-control">
                            <option value="upbeat">Enerjik</option>
                            <option value="relaxing">Rahatlatƒ±cƒ±</option>
                            <option value="epic">Epik</option>
                            <option value="electronic">Elektronik</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Video √ñnizleme Canvas -->
            <canvas id="videoCanvas" width="1080" height="1920"></canvas>
            
            <!-- ƒ∞lerleme √áubuƒüu -->
            <div class="progress-container">
                <div class="progress">
                    <div id="videoProgress" class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%"></div>
                </div>
                <div class="d-flex justify-content-between mt-2">
                    <span id="progressText">%0 Tamamlandƒ±</span>
                    <span id="timeRemaining">Kalan S√ºre: Hesaplanƒ±yor...</span>
                </div>
            </div>
            
            <!-- Video Kontrolleri -->
            <div class="video-controls">
                <button id="createVideoBtn" class="btn btn-success btn-lg">
                    <i class="fas fa-play me-2"></i>Video Olu≈ütur
                </button>
                <button id="cancelVideoBtn" class="btn btn-danger btn-lg" style="display: none;">
                    <i class="fas fa-stop me-2"></i>ƒ∞ptal Et
                </button>
                <button id="previewVideoBtn" class="btn btn-info btn-lg" style="display: none;">
                    <i class="fas fa-eye me-2"></i>√ñnizle
                </button>
                <button id="downloadVideoBtn" class="btn btn-primary btn-lg" style="display: none;">
                    <i class="fas fa-download me-2"></i>Videoyu ƒ∞ndir
                </button>
            </div>
            
            <!-- Video √ñnizleme -->
            <video id="videoPreview" controls style="display: none;"></video>
            
            <!-- Sonu√ßlar -->
            <div id="videoResult" class="mt-4" style="display: none;">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>Video ba≈üarƒ±yla olu≈üturuldu!
                </div>
                
                <h4 class="text-center mb-3">Sosyal Medya ƒ∞√ßerikleri</h4>
                <div id="socialMediaPosts"></div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#shareModal">
                        <i class="fas fa-share-alt me-2"></i>Payla≈üƒ±m Se√ßenekleri
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Payla≈üƒ±m Modalƒ± -->
    <div class="modal fade" id="shareModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-share-alt me-2"></i>Payla≈üƒ±m Se√ßenekleri
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <button class="social-media-btn btn-instagram" onclick="shareToInstagram()">
                        <i class="fab fa-instagram me-2"></i>Instagram
                    </button>
                    <button class="social-media-btn btn-twitter" onclick="shareToTwitter()">
                        <i class="fab fa-twitter me-2"></i>Twitter
                    </button>
                    <button class="social-media-btn btn-facebook" onclick="shareToFacebook()">
                        <i class="fab fa-facebook me-2"></i>Facebook
                    </button>
                    <button class="social-media-btn btn-tiktok" onclick="shareToTiktok()">
                        <i class="fab fa-tiktok me-2"></i>TikTok
                    </button>
                    
                    <div class="mt-4">
                        <h6>Video Dosyasƒ±:</h6>
                        <div class="input-group">
                            <input type="text" id="videoFileName" class="form-control" readonly>
                            <button class="btn btn-outline-secondary" onclick="copyFileName()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global deƒüi≈ükenler
        let allProducts = [];
        let currentProduct = null;
        let currentTemplate = 'modern';
        let isCreatingVideo = false;
        let videoFrames = [];
        let audioContext = null;
        let videoBlob = null;
        
        // Video ≈üablonlarƒ±
        const videoTemplates = [
            {
                id: 'modern',
                name: 'Modern ≈ûablon',
                backgroundColor: '#1a1a2e',
                primaryColor: '#667eea',
                secondaryColor: '#764ba2',
                fontFamily: 'Arial',
                duration: 15
            },
            {
                id: 'minimal',
                name: 'Minimal ≈ûablon',
                backgroundColor: '#ffffff',
                primaryColor: '#333333',
                secondaryColor: '#666666',
                fontFamily: 'Helvetica',
                duration: 12
            },
            {
                id: 'energetic',
                name: 'Enerjik ≈ûablon',
                backgroundColor: '#000000',
                primaryColor: '#ff4757',
                secondaryColor: '#ffd93d',
                fontFamily: 'Impact',
                duration: 10
            },
            {
                id: 'elegant',
                name: 'Zarif ≈ûablon',
                backgroundColor: '#2c3e50',
                primaryColor: '#ecf0f1',
                secondaryColor: '#3498db',
                fontFamily: 'Georgia',
                duration: 18
            }
        ];
        
        // √ñrnek √ºr√ºn verileri (GitHub'dan Excel gelene kadar)
        const sampleProducts = Array.from({length: 24}, (_, i) => ({
            id: `product_${i + 1}`,
            image: `https://picsum.photos/300/200?random=${i + 1}`,
            title: `Harika √úr√ºn ${i + 1} - Kaliteli ve Dayanƒ±klƒ± ${['Mouse Pad', 'Vitamin', 'Giyim', 'Elektronik', 'Oyuncak', 'Spor'][i % 6]}`,
            originalPrice: `EUR ${(Math.random() * 100 + 10).toFixed(2)}`,
            discountPrice: `EUR ${(Math.random() * 50 + 5).toFixed(2)}`,
            discount: `${Math.floor(Math.random() * 70 + 10)}%`,
            rating: `${Math.floor(Math.random() * 20 + 80)}%`,
            sales: Math.floor(Math.random() * 10000),
            code: `KOD${1000 + i}`,
            codeValue: `EUR ${(Math.random() * 5).toFixed(2)}`,
            link: `https://example.com/product/${i + 1}`
        }));
        
        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            loadVideoTemplates();
            setupEventListeners();
        });
        
        function loadProducts() {
            // Burada GitHub'dan Excel dosyasƒ±nƒ± okuyabilirsiniz
            // ≈ûimdilik √∂rnek verilerle devam edelim
            allProducts = sampleProducts;
            displayProducts();
        }
        
        function displayProducts() {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';
            
            allProducts.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
        }
        
        function createProductCard(product) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 col-xl-3 mb-4';
            
            const discountPercent = parseInt(product.discount) || 0;
            
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="position-relative">
                    <img src="${product.image}" 
                         class="card-img-top product-image" 
                         alt="${product.title}"
                         onerror="this.src='https://via.placeholder.com/300x200/667eea/ffffff?text=√úr√ºn+Resmi'">
                    ${discountPercent > 0 ? 
                        `<span class="discount-badge">${product.discount} ƒ∞NDƒ∞Rƒ∞M</span>` : ''}
                </div>
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title product-title" title="${product.title}">${product.title}</h6>
                    
                    <div class="price-container">
                        <span class="original-price">${product.originalPrice}</span>
                        <span class="discount-price">${product.discountPrice}</span>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="text-success">
                            <i class="fas fa-star"></i> ${product.rating}
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-shopping-cart"></i> ${product.sales.toLocaleString()}
                        </small>
                    </div>
                    
                    <button class="btn btn-primary w-100 mt-auto" onclick="selectProduct('${product.id}')">
                        <i class="fas fa-film me-2"></i>Video Olu≈ütur
                    </button>
                </div>
            `;
            
            col.appendChild(card);
            return col;
        }
        
        function loadVideoTemplates() {
            const templatesContainer = document.getElementById('videoTemplates');
            
            videoTemplates.forEach(template => {
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                
                const card = document.createElement('div');
                card.className = 'video-template-card';
                card.dataset.templateId = template.id;
                card.onclick = () => selectTemplate(template.id);
                
                card.innerHTML = `
                    <div class="template-preview" style="background: linear-gradient(135deg, ${template.primaryColor}, ${template.secondaryColor})">
                        <i class="fas fa-play-circle fa-3x"></i>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title">${template.name}</h6>
                        <small class="text-muted">${template.duration}s</small>
                    </div>
                `;
                
                col.appendChild(card);
                templatesContainer.appendChild(col);
            });
            
            // ƒ∞lk ≈üablonu se√ß
            selectTemplate('modern');
        }
        
        function selectTemplate(templateId) {
            currentTemplate = templateId;
            
            // T√ºm ≈üablon kartlarƒ±ndan active class'ƒ±nƒ± kaldƒ±r
            document.querySelectorAll('.video-template-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Se√ßilen ≈üablonu aktif yap
            document.querySelector(`[data-template-id="${templateId}"]`).classList.add('active');
        }
        
        function selectProduct(productId) {
            currentProduct = allProducts.find(p => p.id === productId);
            if (currentProduct) {
                document.getElementById('videoCreationArea').style.display = 'block';
                document.getElementById('productsGrid').style.display = 'none';
                resetVideoCreation();
            }
        }
        
        function goBackToProducts() {
            document.getElementById('videoCreationArea').style.display = 'none';
            document.getElementById('productsGrid').style.display = 'flex';
            resetVideoCreation();
        }
        
        function resetVideoCreation() {
            document.getElementById('videoResult').style.display = 'none';
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('createVideoBtn').style.display = 'block';
            document.getElementById('cancelVideoBtn').style.display = 'none';
            document.getElementById('previewVideoBtn').style.display = 'none';
            document.getElementById('downloadVideoBtn').style.display = 'none';
            document.getElementById('videoProgress').style.width = '0%';
            document.getElementById('progressText').textContent = '%0 Tamamlandƒ±';
            
            videoFrames = [];
            videoBlob = null;
            isCreatingVideo = false;
        }
        
        function setupEventListeners() {
            document.getElementById('createVideoBtn').addEventListener('click', createVideo);
            document.getElementById('cancelVideoBtn').addEventListener('click', cancelVideoCreation);
            document.getElementById('previewVideoBtn').addEventListener('click', previewVideo);
            document.getElementById('downloadVideoBtn').addEventListener('click', downloadVideo);
        }
        
        async function createVideo() {
            if (!currentProduct || isCreatingVideo) return;
            
            isCreatingVideo = true;
            showLoading(true, 'Video olu≈üturuluyor...');
            
            // UI g√ºncelle
            document.getElementById('createVideoBtn').style.display = 'none';
            document.getElementById('cancelVideoBtn').style.display = 'block';
            document.getElementById('videoCanvas').style.display = 'block';
            
            const template = videoTemplates.find(t => t.id === currentTemplate);
            const fps = 30;
            const totalFrames = template.duration * fps;
            
            try {
                // Canvas'ƒ± hazƒ±rla
                const canvas = document.getElementById('videoCanvas');
                const ctx = canvas.getContext('2d');
                
                // Video karelerini olu≈ütur
                for (let frame = 0; frame < totalFrames; frame++) {
                    if (!isCreatingVideo) break;
                    
                    // ƒ∞lerlemeyi g√ºncelle
                    const progress = Math.round((frame / totalFrames) * 100);
                    updateProgress(progress, frame, totalFrames);
                    
                    // Canvas'ƒ± temizle
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Arka plan
                    ctx.fillStyle = template.backgroundColor;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Kare numarasƒ±na g√∂re i√ßerik √ßiz
                    drawVideoFrame(ctx, canvas, frame, totalFrames, template);
                    
                    // Canvas'tan g√∂r√ºnt√ºy√º al
                    const imageData = canvas.toDataURL('image/jpeg', 0.8);
                    videoFrames.push(imageData);
                    
                    // 0 delay ile async i≈ülem
                    await new Promise(resolve => setTimeout(resolve, 0));
                }
                
                if (isCreatingVideo) {
                    // Ses ekle
                    await addAudioToVideo();
                    
                    // Videoyu birle≈ütir
                    await compileVideo();
                    
                    // UI g√ºncelle
                    document.getElementById('cancelVideoBtn').style.display = 'none';
                    document.getElementById('previewVideoBtn').style.display = 'block';
                    document.getElementById('downloadVideoBtn').style.display = 'block';
                    
                    // Sosyal medya i√ßeriklerini olu≈ütur
                    generateSocialMediaPosts();
                    
                    document.getElementById('videoResult').style.display = 'block';
                }
                
            } catch (error) {
                console.error('Video olu≈üturma hatasƒ±:', error);
                alert('Video olu≈üturulurken hata olu≈ütu: ' + error.message);
            } finally {
                showLoading(false);
                isCreatingVideo = false;
            }
        }
        
        function drawVideoFrame(ctx, canvas, frame, totalFrames, template) {
            const width = canvas.width;
            const height = canvas.height;
            const progress = frame / totalFrames;
            
            // B√∂l√ºmlere ayƒ±r (0-0.2: Ba≈ülƒ±k, 0.2-0.4: √úr√ºn, 0.4-0.6: Fiyat, 0.6-0.8: Kupon, 0.8-1: Link)
            const section = progress < 0.2 ? 0 :
                           progress < 0.4 ? 1 :
                           progress < 0.6 ? 2 :
                           progress < 0.8 ? 3 : 4;
            
            // Animasyon efektleri
            const fadeIn = Math.min(progress * 5, 1);
            const scale = 0.8 + fadeIn * 0.2;
            
            switch(section) {
                case 0: // Ba≈ülƒ±k
                    drawTitleSection(ctx, width, height, template, fadeIn);
                    break;
                case 1: // √úr√ºn
                    drawProductSection(ctx, width, height, template, fadeIn);
                    break;
                case 2: // Fiyat
                    drawPriceSection(ctx, width, height, template, fadeIn);
                    break;
                case 3: // Kupon
                    drawCouponSection(ctx, width, height, template, fadeIn);
                    break;
                case 4: // Link
                    drawLinkSection(ctx, width, height, template, fadeIn);
                    break;
            }
            
            // Kenarlƒ±k efekti
            ctx.strokeStyle = template.primaryColor;
            ctx.lineWidth = 10;
            ctx.strokeRect(10, 10, width - 20, height - 20);
            
            // ƒ∞lerleme √ßubuƒüu (alt kƒ±sƒ±m)
            const progressBarWidth = width - 100;
            const progressBarHeight = 20;
            const progressBarY = height - 50;
            
            ctx.fillStyle = 'rgba(255,255,255,0.2)';
            ctx.fillRect(50, progressBarY, progressBarWidth, progressBarHeight);
            
            ctx.fillStyle = template.secondaryColor;
            ctx.fillRect(50, progressBarY, progressBarWidth * progress, progressBarHeight);
            
            // Zaman g√∂stergesi
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 24px ' + template.fontFamily;
            ctx.textAlign = 'center';
            const timeText = `${Math.floor(progress * template.duration)}s / ${template.duration}s`;
            ctx.fillText(timeText, width / 2, progressBarY - 15);
        }
        
        function drawTitleSection(ctx, width, height, template, fadeIn) {
            // Ba≈ülƒ±k arka planƒ±
            const gradient = ctx.createLinearGradient(0, 0, width, 0);
            gradient.addColorStop(0, template.primaryColor);
            gradient.addColorStop(1, template.secondaryColor);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height * 0.3);
            
            // Ba≈ülƒ±k metni
            ctx.fillStyle = '#ffffff';
            ctx.font = `bold ${60 + fadeIn * 20}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 10;
            ctx.fillText('üî• √ñZEL FIRSAT üî•', width / 2, height * 0.15);
            
            // Alt ba≈ülƒ±k
            ctx.font = `italic ${30 + fadeIn * 10}px ${template.fontFamily}`;
            ctx.fillText('Sƒ±nƒ±rlƒ± S√ºre!', width / 2, height * 0.25);
            
            ctx.shadowBlur = 0;
        }
        
        function drawProductSection(ctx, width, height, template, fadeIn) {
            // Arka plan efekti
            const bgGradient = ctx.createRadialGradient(
                width / 2, height / 2, 0,
                width / 2, height / 2, height / 2
            );
            bgGradient.addColorStop(0, 'rgba(102, 126, 234, 0.1)');
            bgGradient.addColorStop(1, 'rgba(118, 75, 162, 0.1)');
            
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, width, height);
            
            // √úr√ºn adƒ±
            ctx.fillStyle = template.primaryColor;
            ctx.font = `bold ${40 + fadeIn * 10}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.fillText(currentProduct.title.substring(0, 50) + '...', width / 2, height * 0.3);
            
            // √úr√ºn g√∂rseli karesi (sim√ºlasyon)
            const imgSize = 300 * fadeIn;
            const imgX = width / 2 - imgSize / 2;
            const imgY = height / 2 - imgSize / 2;
            
            // G√∂rsel √ßer√ßevesi
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(imgX - 10, imgY - 10, imgSize + 20, imgSize + 20);
            
            // G√∂rsel yer tutucu
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(imgX, imgY, imgSize, imgSize);
            
            // G√∂rsel ikonu
            ctx.fillStyle = template.secondaryColor;
            ctx.font = 'bold 80px FontAwesome';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üì±', width / 2, height / 2);
            
            // Ger√ßek g√∂rsel y√ºklenecek olsaydƒ±:
            // const img = new Image();
            // img.src = currentProduct.image;
            // ctx.drawImage(img, imgX, imgY, imgSize, imgSize);
        }
        
        function drawPriceSection(ctx, width, height, template, fadeIn) {
            // Arka plan
            const priceBg = ctx.createLinearGradient(0, 0, 0, height);
            priceBg.addColorStop(0, '#1a1a2e');
            priceBg.addColorStop(1, '#16213e');
            ctx.fillStyle = priceBg;
            ctx.fillRect(0, 0, width, height);
            
            // Fiyat ba≈ülƒ±ƒüƒ±
            ctx.fillStyle = '#ffd93d';
            ctx.font = `bold ${60 * fadeIn}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.fillText('Fƒ∞YAT D√ú≈ûT√ú!', width / 2, height * 0.3);
            
            // Eski fiyat
            ctx.fillStyle = '#aaaaaa';
            ctx.font = `italic ${40 * fadeIn}px ${template.fontFamily}`;
            ctx.textDecoration = 'line-through';
            ctx.fillText(currentProduct.originalPrice, width / 2, height * 0.45);
            
            // Yeni fiyat
            ctx.fillStyle = '#ff6b6b';
            ctx.font = `bold ${80 * fadeIn}px ${template.fontFamily}`;
            ctx.textDecoration = 'none';
            ctx.fillText(currentProduct.discountPrice, width / 2, height * 0.6);
            
            // ƒ∞ndirim oranƒ±
            ctx.fillStyle = '#6bcf7f';
            ctx.font = `bold ${50 * fadeIn}px ${template.fontFamily}`;
            ctx.fillText(currentProduct.discount + ' ƒ∞NDƒ∞Rƒ∞M', width / 2, height * 0.75);
        }
        
        function drawCouponSection(ctx, width, height, template, fadeIn) {
            // Kupon arka planƒ±
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(0, 0, width, height);
            
            // Kupon ba≈ülƒ±ƒüƒ±
            ctx.fillStyle = '#4d96ff';
            ctx.font = `bold ${50 * fadeIn}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.fillText('√ñZEL KUPON KODU', width / 2, height * 0.3);
            
            // Kupon kodu kutusu
            const couponWidth = 600 * fadeIn;
            const couponHeight = 150 * fadeIn;
            const couponX = width / 2 - couponWidth / 2;
            const couponY = height / 2 - couponHeight / 2;
            
            // Kupon kutusu
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(couponX, couponY, couponWidth, couponHeight);
            
            // Kupon deseni
            ctx.strokeStyle = template.primaryColor;
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            ctx.strokeRect(couponX, couponY, couponWidth, couponHeight);
            ctx.setLineDash([]);
            
            // Kupon kodu
            ctx.fillStyle = template.secondaryColor;
            ctx.font = `bold ${70 * fadeIn}px 'Courier New', monospace`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(currentProduct.code, width / 2, height / 2);
            
            // Kupon deƒüeri
            ctx.fillStyle = '#6bcf7f';
            ctx.font = `bold ${30 * fadeIn}px ${template.fontFamily}`;
            ctx.fillText('Deƒüeri: ' + currentProduct.codeValue, width / 2, height * 0.7);
        }
        
        function drawLinkSection(ctx, width, height, template, fadeIn) {
            // Son ekran
            const finalGradient = ctx.createLinearGradient(0, 0, width, height);
            finalGradient.addColorStop(0, template.primaryColor);
            finalGradient.addColorStop(1, template.secondaryColor);
            ctx.fillStyle = finalGradient;
            ctx.fillRect(0, 0, width, height);
            
            // Te≈üekk√ºr mesajƒ±
            ctx.fillStyle = '#ffffff';
            ctx.font = `bold ${60 * fadeIn}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.fillText('HEMEN AL!', width / 2, height * 0.3);
            
            // Link kutusu
            const linkBoxWidth = 800 * fadeIn;
            const linkBoxHeight = 100 * fadeIn;
            const linkBoxX = width / 2 - linkBoxWidth / 2;
            const linkBoxY = height / 2 - linkBoxHeight / 2;
            
            ctx.fillStyle = 'rgba(255,255,255,0.2)';
            ctx.fillRect(linkBoxX, linkBoxY, linkBoxWidth, linkBoxHeight);
            
            // Link
            ctx.fillStyle = '#ffd93d';
            ctx.font = `bold ${30 * fadeIn}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(currentProduct.link, width / 2, height / 2);
            
            // Alt bilgi
            ctx.fillStyle = '#ffffff';
            ctx.font = `italic ${40 * fadeIn}px ${template.fontFamily}`;
            ctx.fillText('‚è∞ Fƒ±rsat sƒ±nƒ±rlƒ± s√ºrelidir!', width / 2, height * 0.7);
            
            // Puan bilgisi
            ctx.font = `bold ${35 * fadeIn}px ${template.fontFamily}`;
            ctx.fillText(`‚≠ê ${currentProduct.rating} M√º≈üteri Puanƒ±`, width / 2, height * 0.8);
        }
        
        function updateProgress(percent, currentFrame, totalFrames) {
            const progressBar = document.getElementById('videoProgress');
            const progressText = document.getElementById('progressText');
            const timeRemaining = document.getElementById('timeRemaining');
            
            progressBar.style.width = percent + '%';
            progressBar.textContent = percent + '%';
            progressText.textContent = `%${percent} Tamamlandƒ±`;
            
            // Kalan s√ºreyi hesapla
            const fps = 30;
            const remainingFrames = totalFrames - currentFrame;
            const remainingSeconds = Math.round(remainingFrames / fps);
            timeRemaining.textContent = `Kalan S√ºre: ${remainingSeconds}s`;
        }
        
        async function addAudioToVideo() {
            if (!document.getElementById('addBackgroundMusic').checked) {
                return;
            }
            
            try {
                // Web Audio API ile basit ses efekti olu≈ütur
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Arka plan m√ºziƒüi (sentezlenmi≈ü)
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 2);
                
            } catch (error) {
                console.warn('Ses olu≈üturulamadƒ±:', error);
            }
        }
        
        async function compileVideo() {
            showLoading(true, 'Video birle≈ütiriliyor...');
            
            try {
                // G√∂r√ºnt√ºleri video'ya d√∂n√º≈üt√ºr
                // NOT: Tarayƒ±cƒ±da MP4 olu≈üturmak i√ßin genellikle bir k√ºt√ºphane gerekir
                // Burada base64 g√∂r√ºnt√ºleri birle≈ütirip zip olarak indireceƒüiz
                
                // Alternatif: WebM formatƒ±nda video olu≈ütur
                await createWebMVideo();
                
                // Alternatif 2: G√∂r√ºnt√ºleri zip olarak indir
                // await createImageZip();
                
            } catch (error) {
                console.error('Video birle≈ütirme hatasƒ±:', error);
                // Fallback: G√∂r√ºnt√ºleri zip olarak indir
                await createImageZip();
            } finally {
                showLoading(false);
            }
        }
        
        async function createWebMVideo() {
            // WebM video olu≈üturma (deneysel)
            try {
                const canvas = document.getElementById('videoCanvas');
                const stream = canvas.captureStream(30);
                const mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm;codecs=vp9'
                });
                
                const chunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        chunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    videoBlob = new Blob(chunks, { type: 'video/webm' });
                    const videoUrl = URL.createObjectURL(videoBlob);
                    
                    const videoPreview = document.getElementById('videoPreview');
                    videoPreview.src = videoUrl;
                    videoPreview.style.display = 'block';
                    
                    // Dosya adƒ±nƒ± ayarla
                    document.getElementById('videoFileName').value = 
                        `urun_videosu_${currentProduct.id}_${new Date().getTime()}.webm`;
                };
                
                // Canvas'ƒ± kaydetmek i√ßin animasyon
                const template = videoTemplates.find(t => t.id === currentTemplate);
                const duration = template.duration * 1000; // ms cinsinden
                
                mediaRecorder.start();
                
                // Canvas animasyonunu oynat
                const ctx = canvas.getContext('2d');
                const startTime = Date.now();
                
                function recordFrame() {
                    if (Date.now() - startTime >= duration) {
                        mediaRecorder.stop();
                        return;
                    }
                    
                    const elapsed = Date.now() - startTime;
                    const progress = elapsed / duration;
                    const frame = Math.floor(progress * (template.duration * 30));
                    
                    // Canvas'ƒ± √ßiz
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    drawVideoFrame(ctx, canvas, frame, template.duration * 30, template);
                    
                    requestAnimationFrame(recordFrame);
                }
                
                recordFrame();
                
            } catch (error) {
                console.error('WebM video olu≈üturma hatasƒ±:', error);
                throw error;
            }
        }
        
        async function createImageZip() {
            // G√∂r√ºnt√ºleri zip olarak indir
            showLoading(true, 'G√∂r√ºnt√ºler ZIP'e paketleniyor...');
            
            const zip = new JSZip();
            const imgFolder = zip.folder('video_frames');
            
            // Her kareyi zip'e ekle
            for (let i = 0; i < videoFrames.length; i++) {
                const frameData = videoFrames[i];
                const base64Data = frameData.split(',')[1];
                imgFolder.file(`frame_${String(i).padStart(5, '0')}.jpg`, base64Data, { base64: true });
                
                // ƒ∞lerlemeyi g√ºncelle
                updateProgress(Math.round((i / videoFrames.length) * 100), i, videoFrames.length);
                await new Promise(resolve => setTimeout(resolve, 0));
            }
            
            // Zip'i olu≈ütur
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            videoBlob = zipBlob;
            
            // Dosya adƒ±nƒ± ayarla
            document.getElementById('videoFileName').value = 
                `video_frames_${currentProduct.id}_${new Date().getTime()}.zip`;
            
            // Bilgi mesajƒ± g√∂ster
            document.getElementById('videoResult').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Video kareleri ZIP dosyasƒ± olarak hazƒ±rlandƒ±. 
                    Bu kareleri video d√ºzenleme yazƒ±lƒ±mƒ± ile birle≈ütirebilirsiniz.
                </div>
                <div id="socialMediaPosts"></div>
            `;
            
            document.getElementById('videoResult').style.display = 'block';
            
            showLoading(false);
        }
        
        function cancelVideoCreation() {
            isCreatingVideo = false;
            resetVideoCreation();
            
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
        }
        
        function previewVideo() {
            if (videoBlob) {
                const videoPreview = document.getElementById('videoPreview');
                videoPreview.src = URL.createObjectURL(videoBlob);
                videoPreview.style.display = 'block';
                videoPreview.play();
            }
        }
        
        function downloadVideo() {
            if (videoBlob) {
                const fileName = document.getElementById('videoFileName').value;
                saveAs(videoBlob, fileName);
            } else {
                alert('√ñnce video olu≈üturmalƒ±sƒ±nƒ±z!');
            }
        }
        
        function showLoading(show, message = '') {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingTitle = document.getElementById('loadingTitle');
            const loadingText = document.getElementById('loadingText');
            
            if (show) {
                loadingOverlay.style.display = 'flex';
                loadingTitle.textContent = message || 'ƒ∞≈ülem Yapƒ±lƒ±yor';
                loadingText.textContent = 'L√ºtfen bekleyin...';
            } else {
                loadingOverlay.style.display = 'none';
            }
        }
        
        function generateSocialMediaPosts() {
            if (!currentProduct) return;
            
            const postsContainer = document.getElementById('socialMediaPosts');
            const discountPercent = parseInt(currentProduct.discount) || 0;
            
            const posts = {
                instagram: `üî• FLASH SATI≈û! üî•

${currentProduct.title}

üè∑Ô∏è Normal Fiyat: ${currentProduct.originalPrice}
üí∞ ƒ∞ndirimli Fiyat: ${currentProduct.discountPrice}
üéÅ Kupon Kodu: ${currentProduct.code} (${currentProduct.codeValue} deƒüerinde!)
‚≠ê M√º≈üteri Puanƒ±: ${currentProduct.rating}
üõí Satƒ±≈ü Adedi: ${currentProduct.sales.toLocaleString()}

üëâ Hemen Al: ${currentProduct.link}

#indirim #kampanya #alƒ±≈üveri≈ü #onlinealƒ±≈üveri≈ü #fƒ±rsat #√ºr√ºn #ecommerce #flashsale`,
                
                twitter: `üö® ƒ∞NDƒ∞Rƒ∞M ALERT! üö®

${currentProduct.title.substring(0, 80)}...

üí∞ Sadece: ${currentProduct.discountPrice} ${discountPercent > 0 ? `(${discountPercent}% indirim!)` : ''}
üéüÔ∏è Kupon: ${currentProduct.code}
‚≠ê ${currentProduct.rating} m√º≈üteri puanƒ±

üîó ${currentProduct.link}

#FlashSale #Deal #Discount #Shopping`,
                
                facebook: `üéâ √ñZEL FIRSAT! üéâ

${currentProduct.title}

üí∏ √ñnceki Fiyat: ${currentProduct.originalPrice}
üí• ƒ∞ndirimli Fiyat: ${currentProduct.discountPrice} ${discountPercent > 0 ? `(${discountPercent}% indirim!)` : ''}
üéÅ Kupon Kodu: ${currentProduct.code} (${currentProduct.codeValue} deƒüerinde!)
‚≠ê M√º≈üteri Puanƒ±: ${currentProduct.rating}
üõí ${currentProduct.sales.toLocaleString()} adet satƒ±ldƒ±!

üõí Hemen satƒ±n almak i√ßin: ${currentProduct.link}

Bu fƒ±rsatƒ± ka√ßƒ±rmayƒ±n! ‚è≥

#Alƒ±≈üveri≈ü #ƒ∞ndirim #Kampanya`,
                
                tiktok: `üî• ƒ∞ndirim fƒ±rsatƒ±! 
${currentProduct.discountPrice} yerine ${currentProduct.originalPrice} 
Kupon: ${currentProduct.code} 
‚≠ê ${currentProduct.rating} m√º≈üteri puanƒ± 
üîó ${currentProduct.link} 
#indirim #alƒ±≈üveri≈ü #fƒ±rsat #online #ecommerce`
            };
            
            postsContainer.innerHTML = '';
            
            for (const [platform, content] of Object.entries(posts)) {
                const card = document.createElement('div');
                card.className = 'card mb-3';
                card.innerHTML = `
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <strong>${platform.toUpperCase()}</strong>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="copyTextToClipboard('${content.replace(/'/g, "\\'")}')">
                                <i class="fas fa-copy"></i> Kopyala
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <textarea class="form-control" rows="4" readonly>${content}</textarea>
                    </div>
                `;
                postsContainer.appendChild(card);
            }
        }
        
        function copyTextToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Metin panoya kopyalandƒ±!');
            }).catch(err => {
                console.error('Kopyalama hatasƒ±:', err);
            });
        }
        
        function copyFileName() {
            const input = document.getElementById('videoFileName');
            input.select();
            document.execCommand('copy');
            alert('Dosya adƒ± kopyalandƒ±!');
        }
        
        function shareToInstagram() {
            copyTextToClipboard(document.querySelector('#socialMediaPosts textarea').value);
            alert('Instagram payla≈üƒ±m metni kopyalandƒ±!');
        }
        
        function shareToTwitter() {
            const text = document.querySelectorAll('#socialMediaPosts textarea')[1].value;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
        }
        
        function shareToFacebook() {
            const text = document.querySelectorAll('#socialMediaPosts textarea')[2].value.substring(0, 200);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentProduct.link)}&quote=${encodeURIComponent(text)}`, '_blank');
        }
        
        function shareToTiktok() {
            copyTextToClipboard(document.querySelectorAll('#socialMediaPosts textarea')[3].value);
            alert('TikTok payla≈üƒ±m metni kopyalandƒ±!');
        }
        
        // GitHub'dan Excel okuma fonksiyonu (isteƒüe baƒülƒ±)
        async function loadExcelFromGitHub() {
            try {
                // GitHub raw URL'sini buraya ekleyin
                const response = await fetch('data22.xls');
                const arrayBuffer = await response.arrayBuffer();
                
                // XLSX.js k√ºt√ºphanesi gereklidir
                // const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                // const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                // const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Verileri i≈üle
                // allProducts = processExcelData(jsonData);
                
            } catch (error) {
                console.error('Excel y√ºkleme hatasƒ±:', error);
                // √ñrnek verilerle devam et
                loadProducts();
            }
        }
    </script>
</body>
</html>
