<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel ÃœrÃ¼n Video OluÅŸturucu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .product-card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            background: white;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .product-image {
            height: 200px;
            object-fit: contain;
            background: #f8f9fa;
            padding: 10px;
            width: 100%;
        }
        
        .discount-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 1;
        }
        
        .price-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #888;
            font-size: 14px;
        }
        
        .discount-price {
            color: var(--danger-color);
            font-size: 24px;
            font-weight: bold;
        }
        
        .video-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        #videoCanvas {
            display: none;
            max-width: 100%;
            margin: 20px auto;
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        #videoPreview {
            max-width: 100%;
            margin: 20px auto;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }
        
        .product-title {
            font-size: 14px;
            height: 60px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress {
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 99999;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        
        .video-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .video-template-card {
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .video-template-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }
        
        .video-template-card.active {
            border-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.1);
        }
        
        .template-preview {
            height: 120px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .social-media-btn {
            margin: 5px;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .social-media-btn:hover {
            transform: scale(1.05);
        }
        
        .btn-instagram {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
            color: white;
            border: none;
        }
        
        .btn-twitter {
            background: #1DA1F2;
            color: white;
            border: none;
        }
        
        .btn-facebook {
            background: #1877F2;
            color: white;
            border: none;
        }
        
        .btn-tiktok {
            background: #000000;
            color: white;
            border: none;
        }
        
        .audio-options {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .filter-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .file-upload-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 10px;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 12px 30px;
            background: var(--primary-color);
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-input-label:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }
        
        .file-name {
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- YÃ¼kleme EkranÄ± -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">YÃ¼kleniyor...</span>
            </div>
            <h4 class="mt-3" id="loadingTitle">Excel DosyasÄ± Okunuyor</h4>
            <div class="progress mt-3">
                <div id="loadingProgress" class="progress-bar progress-bar-striped progress-bar-animated" 
                     role="progressbar" style="width: 0%"></div>
            </div>
            <p id="loadingText" class="mt-2">data22.xls dosyasÄ± iÅŸleniyor...</p>
        </div>
    </div>
    
    <div class="container py-5">
        <!-- BaÅŸlÄ±k -->
        <div class="text-center mb-4">
            <h1 class="text-white fw-bold mb-3">
                <i class="fas fa-film me-2"></i>Excel ÃœrÃ¼n Video OluÅŸturucu
            </h1>
            <p class="text-white lead">Lokal Excel dosyasÄ±ndan Ã¼rÃ¼nleri oku, otomatik video oluÅŸtur!</p>
        </div>
        
        <!-- Excel YÃ¼kleme -->
        <div class="file-upload-container">
            <h4 class="mb-3">
                <i class="fas fa-file-excel me-2 text-success"></i>Excel DosyasÄ±nÄ± YÃ¼kleyin
            </h4>
            <p class="text-muted mb-4">data22.xls dosyasÄ±nÄ± seÃ§in veya aynÄ± klasÃ¶re koyun</p>
            
            <div class="file-input-wrapper">
                <input type="file" id="excelFileInput" accept=".xls,.xlsx" onchange="handleFileSelect(event)">
                <div class="file-input-label">
                    <i class="fas fa-upload me-2"></i>Excel DosyasÄ± SeÃ§
                </div>
            </div>
            
            <div class="file-name">
                <span id="fileName">data22.xls dosyasÄ± bekleniyor...</span>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-success" onclick="loadLocalExcel()">
                    <i class="fas fa-database me-2"></i>Yerel DosyayÄ± YÃ¼kle
                </button>
                <button class="btn btn-info" onclick="loadSampleData()">
                    <i class="fas fa-vial me-2"></i>Ã–rnek Verilerle Devam Et
                </button>
            </div>
        </div>
        
        <!-- Filtreleme -->
        <div class="filter-container" style="display: none;" id="filterContainer">
            <div class="row">
                <div class="col-md-6 mb-2">
                    <input type="text" id="searchInput" class="form-control" placeholder="ÃœrÃ¼n adÄ± veya kodu ara..." onkeyup="filterProducts()">
                </div>
                <div class="col-md-6 mb-2">
                    <select id="sortSelect" class="form-control" onchange="sortProducts()">
                        <option value="discount-high">Ä°ndirime GÃ¶re (YÃ¼ksekten DÃ¼ÅŸÃ¼ÄŸe)</option>
                        <option value="discount-low">Ä°ndirime GÃ¶re (DÃ¼ÅŸÃ¼kten YÃ¼kseÄŸe)</option>
                        <option value="price-high">Fiyata GÃ¶re (YÃ¼ksekten DÃ¼ÅŸÃ¼ÄŸe)</option>
                        <option value="price-low">Fiyata GÃ¶re (DÃ¼ÅŸÃ¼kten YÃ¼kseÄŸe)</option>
                        <option value="sales-high">SatÄ±ÅŸa GÃ¶re (YÃ¼ksekten DÃ¼ÅŸÃ¼ÄŸe)</option>
                        <option value="rating-high">Puana GÃ¶re (YÃ¼ksekten DÃ¼ÅŸÃ¼ÄŸe)</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="filterDiscount" onchange="filterProducts()">
                        <label class="form-check-label" for="filterDiscount">Sadece Ä°ndirimli ÃœrÃ¼nler</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="filterRating" onchange="filterProducts()">
                        <label class="form-check-label" for="filterRating">90%+ Pozitif Puan</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="filterInStock" onchange="filterProducts()">
                        <label class="form-check-label" for="filterInStock">Stokta Olanlar</label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÃœrÃ¼n Grid -->
        <div id="productsGrid" class="row">
            <div class="col-12 text-center py-5">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Excel dosyasÄ± yÃ¼klenmedi. LÃ¼tfen yukarÄ±daki seÃ§eneklerden birini kullanÄ±n.
                </div>
            </div>
        </div>
        
        <!-- Video OluÅŸturma AlanÄ± -->
        <div id="videoCreationArea" class="video-container">
            <button id="backButton" class="btn btn-outline-secondary mb-3" onclick="goBackToProducts()">
                <i class="fas fa-arrow-left me-2"></i>ÃœrÃ¼nlere Geri DÃ¶n
            </button>
            
            <h3 class="text-center mb-4">Video AyarlarÄ±</h3>
            
            <!-- Video ÅžablonlarÄ± -->
            <div class="mb-4">
                <h5><i class="fas fa-palette me-2"></i>Video Åžablonu SeÃ§in:</h5>
                <div class="row" id="videoTemplates">
                    <!-- Åžablonlar buraya eklenecek -->
                </div>
            </div>
            
            <!-- Ses Efektleri -->
            <div class="audio-options">
                <h5><i class="fas fa-music me-2"></i>Ses Efektleri:</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="addBackgroundMusic" checked>
                            <label class="form-check-label" for="addBackgroundMusic">
                                Arka Plan MÃ¼ziÄŸi Ekle
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="addSoundEffects" checked>
                            <label class="form-check-label" for="addSoundEffects">
                                Ses Efektleri Ekle
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="musicStyle"><i class="fas fa-sliders-h me-1"></i>MÃ¼zik Stili:</label>
                        <select id="musicStyle" class="form-control">
                            <option value="upbeat">ðŸŽµ Enerjik</option>
                            <option value="relaxing">ðŸŽ¶ RahatlatÄ±cÄ±</option>
                            <option value="epic">ðŸŽº Epik</option>
                            <option value="electronic">âš¡ Elektronik</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Video SÃ¼resi -->
            <div class="mb-4">
                <h5><i class="fas fa-clock me-2"></i>Video SÃ¼resi:</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="videoDuration" id="durationShort" value="10" checked>
                            <label class="form-check-label" for="durationShort">
                                KÄ±sa (10 saniye)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="videoDuration" id="durationMedium" value="15">
                            <label class="form-check-label" for="durationMedium">
                                Orta (15 saniye)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="videoDuration" id="durationLong" value="20">
                            <label class="form-check-label" for="durationLong">
                                Uzun (20 saniye)
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="videoResolution"><i class="fas fa-expand me-1"></i>Video Ã‡Ã¶zÃ¼nÃ¼rlÃ¼ÄŸÃ¼:</label>
                        <select id="videoResolution" class="form-control">
                            <option value="1080x1920">1080x1920 (TikTok/Reels)</option>
                            <option value="1080x1080">1080x1080 (Instagram)</option>
                            <option value="1280x720">1280x720 (HD)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Video Ã–nizleme Canvas -->
            <div class="text-center">
                <canvas id="videoCanvas" width="1080" height="1920"></canvas>
            </div>
            
            <!-- Ä°lerleme Ã‡ubuÄŸu -->
            <div class="progress-container">
                <div class="progress">
                    <div id="videoProgress" class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%">
                        <span class="progress-text">%0</span>
                    </div>
                </div>
                <div class="d-flex justify-content-between mt-2">
                    <span id="progressText">HazÄ±rlanÄ±yor...</span>
                    <span id="timeRemaining">Kalan SÃ¼re: HesaplanÄ±yor...</span>
                </div>
            </div>
            
            <!-- Video Kontrolleri -->
            <div class="video-controls">
                <button id="createVideoBtn" class="btn btn-success btn-lg">
                    <i class="fas fa-play me-2"></i>Video OluÅŸtur
                </button>
                <button id="cancelVideoBtn" class="btn btn-danger btn-lg" style="display: none;">
                    <i class="fas fa-stop me-2"></i>Ä°ptal Et
                </button>
                <button id="previewVideoBtn" class="btn btn-info btn-lg" style="display: none;">
                    <i class="fas fa-eye me-2"></i>Ã–nizle
                </button>
                <button id="downloadVideoBtn" class="btn btn-primary btn-lg" style="display: none;">
                    <i class="fas fa-download me-2"></i>Videoyu Ä°ndir
                </button>
            </div>
            
            <!-- Video Ã–nizleme -->
            <div class="text-center">
                <video id="videoPreview" controls style="display: none;"></video>
            </div>
            
            <!-- SonuÃ§lar -->
            <div id="videoResult" class="mt-4" style="display: none;">
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>Video baÅŸarÄ±yla oluÅŸturuldu!
                </div>
                
                <h4 class="text-center mb-3"><i class="fas fa-share-alt me-2"></i>Sosyal Medya Ä°Ã§erikleri</h4>
                <div id="socialMediaPosts"></div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#shareModal">
                        <i class="fas fa-share-alt me-2"></i>PaylaÅŸÄ±m SeÃ§enekleri
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- PaylaÅŸÄ±m ModalÄ± -->
    <div class="modal fade" id="shareModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-share-alt me-2"></i>PaylaÅŸÄ±m SeÃ§enekleri
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <button class="social-media-btn btn-instagram" onclick="shareToInstagram()">
                        <i class="fab fa-instagram me-2"></i>Instagram
                    </button>
                    <button class="social-media-btn btn-twitter" onclick="shareToTwitter()">
                        <i class="fab fa-twitter me-2"></i>Twitter
                    </button>
                    <button class="social-media-btn btn-facebook" onclick="shareToFacebook()">
                        <i class="fab fa-facebook me-2"></i>Facebook
                    </button>
                    <button class="social-media-btn btn-tiktok" onclick="shareToTiktok()">
                        <i class="fab fa-tiktok me-2"></i>TikTok
                    </button>
                    
                    <div class="mt-4">
                        <h6><i class="fas fa-file-video me-2"></i>Video DosyasÄ±:</h6>
                        <div class="input-group">
                            <input type="text" id="videoFileName" class="form-control" readonly>
                            <button class="btn btn-outline-secondary" onclick="copyFileName()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Excel dosyasÄ±nÄ±n URL'si - AYNI KLASÃ–RDE olmalÄ±
        const EXCEL_FILE_URL = './data22.xls';
        
        // Global deÄŸiÅŸkenler
        let allProducts = [];
        let filteredProducts = [];
        let currentProduct = null;
        let currentTemplate = 'modern';
        let isCreatingVideo = false;
        let videoFrames = [];
        let audioContext = null;
        let videoBlob = null;
        let currentFile = null;
        
        // Video ÅŸablonlarÄ±
        const videoTemplates = [
            {
                id: 'modern',
                name: 'Modern Åžablon',
                backgroundColor: '#1a1a2e',
                primaryColor: '#667eea',
                secondaryColor: '#764ba2',
                accentColor: '#ffd93d',
                fontFamily: 'Arial, sans-serif'
            },
            {
                id: 'minimal',
                name: 'Minimal Åžablon',
                backgroundColor: '#ffffff',
                primaryColor: '#333333',
                secondaryColor: '#666666',
                accentColor: '#ff4757',
                fontFamily: 'Helvetica, sans-serif'
            },
            {
                id: 'energetic',
                name: 'Enerjik Åžablon',
                backgroundColor: '#000000',
                primaryColor: '#ff4757',
                secondaryColor: '#ffd93d',
                accentColor: '#00d2d3',
                fontFamily: 'Impact, sans-serif'
            },
            {
                id: 'elegant',
                name: 'Zarif Åžablon',
                backgroundColor: '#2c3e50',
                primaryColor: '#ecf0f1',
                secondaryColor: '#3498db',
                accentColor: '#9b59b6',
                fontFamily: 'Georgia, serif'
            }
        ];
        
        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', function() {
            loadVideoTemplates();
            setupEventListeners();
            
            // VarsayÄ±lan olarak yerel dosyayÄ± yÃ¼klemeyi dene
            setTimeout(() => {
                loadLocalExcel();
            }, 1000);
        });
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            currentFile = file;
            document.getElementById('fileName').textContent = `SeÃ§ilen dosya: ${file.name}`;
            document.getElementById('fileName').style.color = 'var(--success-color)';
            
            readExcelFile(file);
        }
        
        async function loadLocalExcel() {
            try {
                showLoading(true, 'Lokal Excel dosyasÄ± yÃ¼kleniyor...', 'data22.xls dosyasÄ± aranÄ±yor...');
                
                // Ä°lk olarak input'tan seÃ§ilen dosyayÄ± kontrol et
                if (currentFile) {
                    await readExcelFile(currentFile);
                    return;
                }
                
                // Lokal dosyayÄ± yÃ¼kle
                const response = await fetch(EXCEL_FILE_URL);
                
                if (!response.ok) {
                    throw new Error(`Dosya bulunamadÄ±: ${response.status} ${response.statusText}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                
                // Excel'i oku
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                // Ä°lk sayfayÄ± al
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // JSON formatÄ±na Ã§evir
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Verileri iÅŸle
                allProducts = processExcelData(jsonData);
                filteredProducts = [...allProducts];
                
                // BaÅŸarÄ± mesajÄ±
                document.getElementById('fileName').textContent = `âœ“ data22.xls baÅŸarÄ±yla yÃ¼klendi (${allProducts.length} Ã¼rÃ¼n)`;
                document.getElementById('fileName').style.color = 'var(--success-color)';
                
                // ÃœrÃ¼nleri gÃ¶ster
                displayProducts();
                
                // Filtreleri gÃ¶ster
                document.getElementById('filterContainer').style.display = 'block';
                
                showLoading(false);
                
            } catch (error) {
                console.error('Excel yÃ¼kleme hatasÄ±:', error);
                
                document.getElementById('fileName').textContent = `âœ— Hata: ${error.message}`;
                document.getElementById('fileName').style.color = 'var(--danger-color)';
                
                showLoading(false);
                
                // KullanÄ±cÄ±ya bilgi ver
                setTimeout(() => {
                    alert(`Excel dosyasÄ± yÃ¼klenemedi:\n${error.message}\n\n"Ã–rnek Verilerle Devam Et" butonuna tÄ±klayabilirsiniz.`);
                }, 500);
            }
        }
        
        async function readExcelFile(file) {
            try {
                showLoading(true, 'Excel dosyasÄ± okunuyor...', `${file.name} iÅŸleniyor...`);
                
                const arrayBuffer = await file.arrayBuffer();
                
                // Excel'i oku
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                // Ä°lk sayfayÄ± al
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // JSON formatÄ±na Ã§evir
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Verileri iÅŸle
                allProducts = processExcelData(jsonData);
                filteredProducts = [...allProducts];
                
                // BaÅŸarÄ± mesajÄ±
                document.getElementById('fileName').textContent = `âœ“ ${file.name} baÅŸarÄ±yla yÃ¼klendi (${allProducts.length} Ã¼rÃ¼n)`;
                document.getElementById('fileName').style.color = 'var(--success-color)';
                
                // ÃœrÃ¼nleri gÃ¶ster
                displayProducts();
                
                // Filtreleri gÃ¶ster
                document.getElementById('filterContainer').style.display = 'block';
                
                showLoading(false);
                
            } catch (error) {
                console.error('Excel okuma hatasÄ±:', error);
                
                document.getElementById('fileName').textContent = `âœ— Hata: ${error.message}`;
                document.getElementById('fileName').style.color = 'var(--danger-color)';
                
                showLoading(false);
                
                alert(`Excel dosyasÄ± okunamadÄ±:\n${error.message}`);
            }
        }
        
        function processExcelData(jsonData) {
            return jsonData.map((item, index) => {
                try {
                    // Temel alanlarÄ± kontrol et
                    const productId = item.ProductId || item.productId || item['Product Id'] || `product_${index + 1}`;
                    
                    // GÃ¶rsel URL'si
                    let imageUrl = item['Image Url'] || item.imageUrl || item['Image URL'] || '';
                    if (!imageUrl && item['Video Url']) {
                        imageUrl = item['Video Url']; // Video URL'sini fallback olarak kullan
                    }
                    
                    // ÃœrÃ¼n aÃ§Ä±klamasÄ±
                    const productDesc = item['Product Desc'] || item.productDesc || item.Description || item.description || 'ÃœrÃ¼n aÃ§Ä±klamasÄ± yok';
                    
                    // FiyatlarÄ± temizle
                    const originPriceText = item['Origin Price'] || item.originPrice || item.Price || '0';
                    const discountPriceText = item['Discount Price'] || item.discountPrice || item['Sale Price'] || '0';
                    
                    const originPrice = cleanPrice(originPriceText);
                    const discountPrice = cleanPrice(discountPriceText);
                    
                    // Ä°ndirim yÃ¼zdesi
                    let discountPercent = '0%';
                    if (item.Discount && typeof item.Discount === 'string') {
                        discountPercent = item.Discount;
                    } else if (originPrice > 0 && discountPrice > 0) {
                        const discount = Math.round((1 - discountPrice / originPrice) * 100);
                        discountPercent = `${discount}%`;
                    }
                    
                    // SatÄ±ÅŸ sayÄ±sÄ±
                    const sales = parseInt(item['Sales180Day'] || item.Sales || item['Total Sales'] || '0');
                    
                    // Puan
                    let rating = '0%';
                    if (item['Positive Feedback'] && typeof item['Positive Feedback'] === 'string') {
                        rating = item['Positive Feedback'];
                    } else if (item.Rating) {
                        rating = `${parseFloat(item.Rating) * 20}%`;
                    }
                    
                    // Kupon bilgileri
                    const codeName = item['Code Name'] || item.codeName || item.Coupon || `KOD${1000 + index}`;
                    const codeValue = item['Code Value'] || item.codeValue || item['Coupon Value'] || 'EUR 0.99';
                    
                    // Link
                    const promotionUrl = item['Promotion Url'] || item.promotionUrl || item.URL || item.Link || '#';
                    
                    return {
                        id: productId,
                        image: imageUrl,
                        title: productDesc.substring(0, 150), // Maksimum 150 karakter
                        originalPrice: formatPrice(originPrice),
                        discountPrice: formatPrice(discountPrice),
                        discount: discountPercent,
                        rating: rating,
                        sales: sales,
                        code: codeName,
                        codeValue: codeValue,
                        link: promotionUrl,
                        rawOriginalPrice: originPrice,
                        rawDiscountPrice: discountPrice,
                        currency: item.Currency || 'EUR',
                        stock: item.Stock || item['Stock Quantity'] || Math.floor(Math.random() * 1000)
                    };
                } catch (error) {
                    console.warn(`ÃœrÃ¼n ${index} iÅŸlenirken hata:`, error);
                    return {
                        id: `error_${index}`,
                        image: '',
                        title: 'HatalÄ± Ã¼rÃ¼n verisi',
                        originalPrice: 'EUR 0.00',
                        discountPrice: 'EUR 0.00',
                        discount: '0%',
                        rating: '0%',
                        sales: 0,
                        code: 'HATA',
                        codeValue: 'EUR 0.00',
                        link: '#',
                        rawOriginalPrice: 0,
                        rawDiscountPrice: 0,
                        currency: 'EUR',
                        stock: 0
                    };
                }
            }).filter(product => product.title !== 'HatalÄ± Ã¼rÃ¼n verisi'); // HatalÄ± Ã¼rÃ¼nleri filtrele
        }
        
        function cleanPrice(price) {
            if (!price) return 0;
            
            // String'e Ã§evir
            let priceStr = String(price);
            
            // EUR, $ gibi para birimlerini kaldÄ±r
            priceStr = priceStr.replace(/[^\d.,]/g, '');
            
            // VirgÃ¼lleri noktaya Ã§evir
            priceStr = priceStr.replace(',', '.');
            
            // Birden fazla noktayÄ± tek noktaya Ã§evir
            const parts = priceStr.split('.');
            if (parts.length > 2) {
                priceStr = parts[0] + '.' + parts.slice(1).join('');
            }
            
            const num = parseFloat(priceStr);
            return isNaN(num) ? 0 : Math.max(0, num);
        }
        
        function formatPrice(price) {
            if (price === 0) return 'EUR 0.00';
            return `EUR ${price.toFixed(2)}`;
        }
        
        function loadSampleData() {
            showLoading(true, 'Ã–rnek veriler yÃ¼kleniyor...');
            
            // Ã–rnek veriler
            allProducts = Array.from({length: 50}, (_, i) => ({
                id: `sample_${i + 1}`,
                image: `https://picsum.photos/300/200?random=${i + 1}&product`,
                title: `Ã–rnek ÃœrÃ¼n ${i + 1} - ${['Premium Kalite', 'SÃ¼per Ä°ndirim', 'Son Teknoloji', 'DoÄŸal Organik', 'LÃ¼ks TasarÄ±m'][i % 5]} ${['Mouse Pad', 'Vitamin Takviyesi', 'Spor Giyim', 'Elektronik Cihaz', 'Oyuncak FigÃ¼r', 'Ev Dekorasyonu'][i % 6]}`,
                originalPrice: `EUR ${(Math.random() * 100 + 10).toFixed(2)}`,
                discountPrice: `EUR ${(Math.random() * 50 + 5).toFixed(2)}`,
                discount: `${Math.floor(Math.random() * 70 + 10)}%`,
                rating: `${Math.floor(Math.random() * 20 + 80)}%`,
                sales: Math.floor(Math.random() * 10000),
                code: `KOD${1000 + i}`,
                codeValue: `EUR ${(Math.random() * 5).toFixed(2)}`,
                link: `https://example.com/product/${i + 1}`,
                rawOriginalPrice: parseFloat((Math.random() * 100 + 10).toFixed(2)),
                rawDiscountPrice: parseFloat((Math.random() * 50 + 5).toFixed(2)),
                currency: 'EUR',
                stock: Math.floor(Math.random() * 1000)
            }));
            
            filteredProducts = [...allProducts];
            
            document.getElementById('fileName').textContent = `âœ“ Ã–rnek veriler yÃ¼klendi (${allProducts.length} Ã¼rÃ¼n)`;
            document.getElementById('fileName').style.color = 'var(--info-color)';
            
            // ÃœrÃ¼nleri gÃ¶ster
            displayProducts();
            
            // Filtreleri gÃ¶ster
            document.getElementById('filterContainer').style.display = 'block';
            
            showLoading(false);
        }
        
        function displayProducts() {
            const productsGrid = document.getElementById('productsGrid');
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Filtre kriterlerine uygun Ã¼rÃ¼n bulunamadÄ±.
                        </div>
                    </div>
                `;
                return;
            }
            
            productsGrid.innerHTML = '';
            
            // Ä°lk 24 Ã¼rÃ¼nÃ¼ gÃ¶ster (performans iÃ§in)
            const displayProducts = filteredProducts.slice(0, 24);
            
            displayProducts.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
            
            // Daha fazla Ã¼rÃ¼n varsa gÃ¶ster
            if (filteredProducts.length > 24) {
                const moreCol = document.createElement('div');
                moreCol.className = 'col-12 text-center mt-4';
                moreCol.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Toplam ${filteredProducts.length} Ã¼rÃ¼n bulundu. 
                        Ä°lk 24 Ã¼rÃ¼n gÃ¶steriliyor. 
                        <button class="btn btn-sm btn-outline-info ms-2" onclick="showAllProducts()">
                            TÃ¼mÃ¼nÃ¼ GÃ¶ster
                        </button>
                    </div>
                `;
                productsGrid.appendChild(moreCol);
            }
        }
        
        function showAllProducts() {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';
            
            filteredProducts.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
        }
        
        function createProductCard(product) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 col-xl-3 mb-4';
            
            const discountPercent = parseInt(product.discount) || 0;
            const ratingPercent = parseInt(product.rating) || 0;
            
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <div class="position-relative">
                    <img src="${product.image}" 
                         class="card-img-top product-image" 
                         alt="${product.title}"
                         onerror="this.src='https://via.placeholder.com/300x200/667eea/ffffff?text=ÃœrÃ¼n+${product.id}'">
                    ${discountPercent > 0 ? 
                        `<span class="discount-badge">${product.discount} Ä°NDÄ°RÄ°M</span>` : ''}
                    ${product.stock < 10 ? 
                        `<span class="discount-badge" style="top: 50px; background: var(--warning-color);">AZ STOK</span>` : ''}
                </div>
                <div class="card-body d-flex flex-column">
                    <h6 class="card-title product-title" title="${product.title}">${product.title}</h6>
                    
                    <div class="price-container">
                        <span class="original-price">${product.originalPrice}</span>
                        <span class="discount-price">${product.discountPrice}</span>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <small class="${ratingPercent >= 90 ? 'text-success' : ratingPercent >= 70 ? 'text-warning' : 'text-danger'}">
                            <i class="fas fa-star"></i> ${product.rating}
                        </small>
                        <small class="text-muted">
                            <i class="fas fa-shopping-cart"></i> ${product.sales.toLocaleString()}
                        </small>
                        <small class="text-info">
                            <i class="fas fa-box"></i> ${product.stock}
                        </small>
                    </div>
                    
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-tag"></i> Kupon: ${product.code}
                        </small>
                    </div>
                    
                    <button class="btn btn-primary w-100 mt-auto" onclick="selectProduct('${product.id}')">
                        <i class="fas fa-film me-2"></i>Video OluÅŸtur
                    </button>
                </div>
            `;
            
            col.appendChild(card);
            return col;
        }
        
        function filterProducts() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const filterDiscount = document.getElementById('filterDiscount').checked;
            const filterRating = document.getElementById('filterRating').checked;
            const filterInStock = document.getElementById('filterInStock').checked;
            
            filteredProducts = allProducts.filter(product => {
                // Arama filtresi
                const matchesSearch = product.title.toLowerCase().includes(searchText) ||
                                    product.code.toLowerCase().includes(searchText) ||
                                    product.id.toLowerCase().includes(searchText);
                
                // Ä°ndirim filtresi
                const hasDiscount = filterDiscount ? (parseInt(product.discount) > 0) : true;
                
                // Puan filtresi
                const hasHighRating = filterRating ? (parseInt(product.rating) >= 90) : true;
                
                // Stok filtresi
                const isInStock = filterInStock ? (product.stock > 0) : true;
                
                return matchesSearch && hasDiscount && hasHighRating && isInStock;
            });
            
            displayProducts();
        }
        
        function sortProducts() {
            const sortBy = document.getElementById('sortSelect').value;
            
            filteredProducts.sort((a, b) => {
                switch(sortBy) {
                    case 'discount-high':
                        return (parseInt(b.discount) || 0) - (parseInt(a.discount) || 0);
                    case 'discount-low':
                        return (parseInt(a.discount) || 0) - (parseInt(b.discount) || 0);
                    case 'price-high':
                        return b.rawDiscountPrice - a.rawDiscountPrice;
                    case 'price-low':
                        return a.rawDiscountPrice - b.rawDiscountPrice;
                    case 'sales-high':
                        return b.sales - a.sales;
                    case 'rating-high':
                        return (parseInt(b.rating) || 0) - (parseInt(a.rating) || 0);
                    default:
                        return 0;
                }
            });
            
            displayProducts();
        }
        
        function loadVideoTemplates() {
            const templatesContainer = document.getElementById('videoTemplates');
            templatesContainer.innerHTML = '';
            
            videoTemplates.forEach(template => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-3 mb-3';
                
                const card = document.createElement('div');
                card.className = 'video-template-card';
                card.dataset.templateId = template.id;
                card.onclick = () => selectTemplate(template.id);
                
                card.innerHTML = `
                    <div class="template-preview" style="background: linear-gradient(135deg, ${template.primaryColor}, ${template.secondaryColor})">
                        <div class="text-center">
                            <i class="fas fa-play-circle fa-3x mb-2"></i>
                            <div style="font-size: 14px;">${template.name}</div>
                        </div>
                    </div>
                `;
                
                col.appendChild(card);
                templatesContainer.appendChild(col);
            });
            
            // Ä°lk ÅŸablonu seÃ§
            selectTemplate('modern');
        }
        
        function selectTemplate(templateId) {
            currentTemplate = templateId;
            
            // TÃ¼m ÅŸablon kartlarÄ±ndan active class'Ä±nÄ± kaldÄ±r
            document.querySelectorAll('.video-template-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // SeÃ§ilen ÅŸablonu aktif yap
            const selectedCard = document.querySelector(`[data-template-id="${templateId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('active');
            }
        }
        
        function selectProduct(productId) {
            currentProduct = allProducts.find(p => p.id === productId);
            if (currentProduct) {
                document.getElementById('videoCreationArea').style.display = 'block';
                document.getElementById('productsGrid').style.display = 'none';
                document.getElementById('filterContainer').style.display = 'none';
                document.querySelector('.file-upload-container').style.display = 'none';
                resetVideoCreation();
            }
        }
        
        function goBackToProducts() {
            document.getElementById('videoCreationArea').style.display = 'none';
            document.getElementById('productsGrid').style.display = 'flex';
            document.getElementById('filterContainer').style.display = 'block';
            document.querySelector('.file-upload-container').style.display = 'block';
            resetVideoCreation();
        }
        
        function setupEventListeners() {
            document.getElementById('createVideoBtn').addEventListener('click', createVideo);
            document.getElementById('cancelVideoBtn').addEventListener('click', cancelVideoCreation);
            document.getElementById('previewVideoBtn').addEventListener('click', previewVideo);
            document.getElementById('downloadVideoBtn').addEventListener('click', downloadVideo);
        }
        
        async function createVideo() {
            if (!currentProduct || isCreatingVideo) return;
            
            isCreatingVideo = true;
            showLoading(true, 'Video oluÅŸturuluyor...', 'LÃ¼tfen bekleyin...');
            
            // UI gÃ¼ncelle
            document.getElementById('createVideoBtn').style.display = 'none';
            document.getElementById('cancelVideoBtn').style.display = 'block';
            document.getElementById('videoCanvas').style.display = 'block';
            
            try {
                // Video ayarlarÄ±nÄ± al
                const duration = parseInt(document.querySelector('input[name="videoDuration"]:checked').value);
                const fps = 30;
                const totalFrames = duration * fps;
                
                // Canvas boyutlarÄ±nÄ± ayarla
                const resolution = document.getElementById('videoResolution').value;
                const [width, height] = resolution.split('x').map(Number);
                const canvas = document.getElementById('videoCanvas');
                canvas.width = width;
                canvas.height = height;
                canvas.style.width = '100%';
                canvas.style.height = 'auto';
                
                const ctx = canvas.getContext('2d');
                videoFrames = [];
                
                // Her kareyi oluÅŸtur
                for (let frame = 0; frame < totalFrames; frame++) {
                    if (!isCreatingVideo) break;
                    
                    // Ä°lerlemeyi gÃ¼ncelle
                    const progress = Math.round((frame / totalFrames) * 100);
                    updateProgress(progress, frame, totalFrames);
                    
                    // Canvas'Ä± temizle ve Ã§iz
                    ctx.clearRect(0, 0, width, height);
                    drawVideoFrame(ctx, width, height, frame, totalFrames);
                    
                    // Canvas'tan gÃ¶rÃ¼ntÃ¼yÃ¼ al (dÃ¼ÅŸÃ¼k kalite)
                    try {
                        const imageData = canvas.toDataURL('image/jpeg', 0.7);
                        videoFrames.push(imageData);
                    } catch (e) {
                        console.warn('GÃ¶rÃ¼ntÃ¼ alÄ±namadÄ±:', e);
                    }
                    
                    // KÄ±sa bekleme
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
                
                if (isCreatingVideo && videoFrames.length > 0) {
                    // Videoyu birleÅŸtir
                    await compileVideo();
                    
                    // UI gÃ¼ncelle
                    document.getElementById('cancelVideoBtn').style.display = 'none';
                    document.getElementById('previewVideoBtn').style.display = 'block';
                    document.getElementById('downloadVideoBtn').style.display = 'block';
                    
                    // Sosyal medya iÃ§eriklerini oluÅŸtur
                    generateSocialMediaPosts();
                    
                    document.getElementById('videoResult').style.display = 'block';
                }
                
            } catch (error) {
                console.error('Video oluÅŸturma hatasÄ±:', error);
                alert('Video oluÅŸturulurken hata oluÅŸtu: ' + error.message);
            } finally {
                showLoading(false);
                isCreatingVideo = false;
            }
        }
        
        function drawVideoFrame(ctx, width, height, frame, totalFrames) {
            const template = videoTemplates.find(t => t.id === currentTemplate);
            const progress = frame / totalFrames;
            
            // Arka plan
            ctx.fillStyle = template.backgroundColor;
            ctx.fillRect(0, 0, width, height);
            
            // Animasyon efekti
            const scale = 0.9 + (Math.sin(progress * Math.PI * 2) * 0.1);
            const opacity = 0.5 + (Math.sin(progress * Math.PI) * 0.5);
            
            // BaÅŸlÄ±k
            ctx.save();
            ctx.translate(width / 2, height * 0.2);
            ctx.scale(scale, scale);
            ctx.fillStyle = template.primaryColor;
            ctx.font = `bold ${Math.min(60, width / 20)}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ðŸ”¥ Ã–ZEL TEKLÄ°F ðŸ”¥', 0, 0);
            ctx.restore();
            
            // ÃœrÃ¼n adÄ±
            ctx.fillStyle = template.secondaryColor;
            ctx.font = `bold ${Math.min(40, width / 30)}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.fillText(currentProduct.title.substring(0, 50) + '...', width / 2, height * 0.4);
            
            // Fiyatlar
            ctx.fillStyle = '#888888';
            ctx.font = `italic ${Math.min(35, width / 35)}px ${template.fontFamily}`;
            ctx.fillText(currentProduct.originalPrice, width / 2, height * 0.55);
            
            ctx.fillStyle = template.accentColor;
            ctx.font = `bold ${Math.min(60, width / 20)}px ${template.fontFamily}`;
            ctx.fillText(currentProduct.discountPrice, width / 2, height * 0.65);
            
            // Ä°ndirim
            ctx.fillStyle = template.primaryColor;
            ctx.font = `bold ${Math.min(40, width / 30)}px ${template.fontFamily}`;
            ctx.fillText(currentProduct.discount + ' Ä°NDÄ°RÄ°M', width / 2, height * 0.75);
            
            // Kupon
            ctx.fillStyle = '#ffffff';
            ctx.font = `bold ${Math.min(30, width / 40)}px 'Courier New', monospace`;
            ctx.fillText('Kupon: ' + currentProduct.code, width / 2, height * 0.85);
            
            // Ä°lerleme Ã§ubuÄŸu
            const barWidth = width * 0.8;
            const barHeight = 20;
            const barX = (width - barWidth) / 2;
            const barY = height * 0.95;
            
            ctx.fillStyle = 'rgba(255,255,255,0.2)';
            ctx.fillRect(barX, barY, barWidth, barHeight);
            
            ctx.fillStyle = template.secondaryColor;
            ctx.fillRect(barX, barY, barWidth * progress, barHeight);
            
            // Ä°lerleme yÃ¼zdesi
            ctx.fillStyle = '#ffffff';
            ctx.font = `bold ${Math.min(20, width / 60)}px ${template.fontFamily}`;
            ctx.textAlign = 'center';
            ctx.fillText(`${Math.round(progress * 100)}%`, width / 2, barY + barHeight / 2 + 5);
        }
        
        function updateProgress(percent, currentFrame, totalFrames) {
            const progressBar = document.getElementById('videoProgress');
            const progressText = document.getElementById('progressText');
            const timeRemaining = document.getElementById('timeRemaining');
            
            progressBar.style.width = percent + '%';
            progressBar.querySelector('.progress-text').textContent = percent + '%';
            progressText.textContent = `Kare ${currentFrame + 1}/${totalFrames}`;
            
            // Kalan sÃ¼reyi hesapla
            const fps = 30;
            const remainingFrames = totalFrames - currentFrame;
            const remainingSeconds = Math.round(remainingFrames / fps);
            timeRemaining.textContent = `Kalan: ${remainingSeconds}s`;
        }
        
        async function compileVideo() {
            showLoading(true, 'Video birleÅŸtiriliyor...', 'MP4 dosyasÄ± oluÅŸturuluyor...');
            
            try {
                // TarayÄ±cÄ±da MP4 oluÅŸturmak zor, WebM kullanacaÄŸÄ±z
                await createWebMVideo();
                
                // Dosya adÄ±nÄ± ayarla
                const timestamp = new Date().getTime();
                const fileName = `urun_videosu_${currentProduct.id}_${timestamp}.webm`;
                document.getElementById('videoFileName').value = fileName;
                
            } catch (error) {
                console.error('Video birleÅŸtirme hatasÄ±:', error);
                // Fallback: GÃ¶rÃ¼ntÃ¼leri zip olarak indir
                await createImageZip();
            } finally {
                showLoading(false);
            }
        }
        
        async function createWebMVideo() {
            const canvas = document.getElementById('videoCanvas');
            const stream = canvas.captureStream(30);
            const mediaRecorder = new MediaRecorder(stream, {
                mimeType: 'video/webm;codecs=vp9'
            });
            
            const chunks = [];
            
            return new Promise((resolve, reject) => {
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        chunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    videoBlob = new Blob(chunks, { type: 'video/webm' });
                    const videoUrl = URL.createObjectURL(videoBlob);
                    
                    const videoPreview = document.getElementById('videoPreview');
                    videoPreview.src = videoUrl;
                    videoPreview.style.display = 'block';
                    
                    resolve();
                };
                
                mediaRecorder.onerror = (error) => {
                    reject(error);
                };
                
                // KÄ±sa bir video kaydet (performans iÃ§in)
                mediaRecorder.start();
                
                // 3 saniye kayÄ±t yap (demo)
                setTimeout(() => {
                    if (mediaRecorder.state === 'recording') {
                        mediaRecorder.stop();
                    }
                }, 3000);
            });
        }
        
        async function createImageZip() {
            const zip = new JSZip();
            const imgFolder = zip.folder('video_frames');
            
            for (let i = 0; i < Math.min(videoFrames.length, 30); i++) { // Max 30 frame
                const frameData = videoFrames[i];
                const base64Data = frameData.split(',')[1];
                imgFolder.file(`frame_${String(i).padStart(3, '0')}.jpg`, base64Data, { base64: true });
                
                updateProgress(Math.round((i / 30) * 100), i, 30);
                await new Promise(resolve => setTimeout(resolve, 10));
            }
            
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            videoBlob = zipBlob;
            
            const timestamp = new Date().getTime();
            const fileName = `video_frames_${currentProduct.id}_${timestamp}.zip`;
            document.getElementById('videoFileName').value = fileName;
            
            document.getElementById('videoResult').innerHTML = `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Video kareleri ZIP dosyasÄ± olarak hazÄ±rlandÄ±. 
                    Kareleri video dÃ¼zenleme programÄ± ile birleÅŸtirebilirsiniz.
                </div>
                <div id="socialMediaPosts"></div>
            `;
            
            document.getElementById('videoResult').style.display = 'block';
        }
        
        function cancelVideoCreation() {
            isCreatingVideo = false;
            resetVideoCreation();
            
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
        }
        
        function previewVideo() {
            if (videoBlob) {
                const videoPreview = document.getElementById('videoPreview');
                videoPreview.src = URL.createObjectURL(videoBlob);
                videoPreview.style.display = 'block';
                videoPreview.play().catch(e => console.log('Video otomatik oynatÄ±lamadÄ±:', e));
            }
        }
        
        function downloadVideo() {
            if (videoBlob) {
                const fileName = document.getElementById('videoFileName').value;
                saveAs(videoBlob, fileName);
            } else {
                alert('Ã–nce video oluÅŸturmalÄ±sÄ±nÄ±z!');
            }
        }
        
        function showLoading(show, title = '', message = '') {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingTitle = document.getElementById('loadingTitle');
            const loadingText = document.getElementById('loadingText');
            const loadingProgress = document.getElementById('loadingProgress');
            
            if (show) {
                loadingOverlay.style.display = 'flex';
                loadingTitle.textContent = title || 'Ä°ÅŸlem YapÄ±lÄ±yor';
                loadingText.textContent = message || 'LÃ¼tfen bekleyin...';
                loadingProgress.style.width = '0%';
            } else {
                loadingOverlay.style.display = 'none';
            }
        }
        
        function generateSocialMediaPosts() {
            if (!currentProduct) return;
            
            const postsContainer = document.getElementById('socialMediaPosts');
            const discountPercent = parseInt(currentProduct.discount) || 0;
            
            const posts = {
                instagram: `ðŸ”¥ FLASH SATIÅž! ðŸ”¥

${currentProduct.title}

ðŸ·ï¸ Normal Fiyat: ${currentProduct.originalPrice}
ðŸ’° Ä°ndirimli Fiyat: ${currentProduct.discountPrice}
ðŸŽ Kupon Kodu: ${currentProduct.code} (${currentProduct.codeValue} deÄŸerinde!)
â­ MÃ¼ÅŸteri PuanÄ±: ${currentProduct.rating}
ðŸ›’ ${currentProduct.sales.toLocaleString()} adet satÄ±ldÄ±!

ðŸ‘‰ Hemen Al: ${currentProduct.link}

#indirim #kampanya #alÄ±ÅŸveriÅŸ #onlinealÄ±ÅŸveriÅŸ #fÄ±rsat #Ã¼rÃ¼n #ecommerce #flashsale #alÄ±ÅŸveriÅŸfÄ±rsatÄ±`,
                
                twitter: `ðŸš¨ Ä°NDÄ°RÄ°M ALERT! ðŸš¨

${currentProduct.title.substring(0, 80)}...

ðŸ’° Sadece: ${currentProduct.discountPrice} ${discountPercent > 0 ? `(${discountPercent}% indirim!)` : ''}
ðŸŽŸï¸ Kupon: ${currentProduct.code}
â­ ${currentProduct.rating} mÃ¼ÅŸteri puanÄ±

ðŸ”— ${currentProduct.link}

#FlashSale #Deal #Discount #Shopping #OnlineShopping`,
                
                facebook: `ðŸŽ‰ Ã–ZEL FIRSAT! ðŸŽ‰

${currentProduct.title}

ðŸ’¸ Ã–nceki Fiyat: ${currentProduct.originalPrice}
ðŸ’¥ Ä°ndirimli Fiyat: ${currentProduct.discountPrice} ${discountPercent > 0 ? `(${discountPercent}% indirim!)` : ''}
ðŸŽ Kupon Kodu: ${currentProduct.code} (${currentProduct.codeValue} deÄŸerinde!)
â­ MÃ¼ÅŸteri PuanÄ±: ${currentProduct.rating}
ðŸ›’ ${currentProduct.sales.toLocaleString()} adet satÄ±ldÄ±!

ðŸ›’ Hemen satÄ±n almak iÃ§in: ${currentProduct.link}

Bu fÄ±rsatÄ± kaÃ§Ä±rmayÄ±n! â³

#AlÄ±ÅŸveriÅŸ #Ä°ndirim #Kampanya #OnlineAlÄ±ÅŸveriÅŸ #FÄ±rsatÃœrÃ¼nÃ¼ #FlashSale`,
                
                tiktok: `ðŸ”¥ Ä°ndirim fÄ±rsatÄ±! 
${currentProduct.discountPrice} yerine ${currentProduct.originalPrice} 
Kupon: ${currentProduct.code} 
â­ ${currentProduct.rating} mÃ¼ÅŸteri puanÄ± 
ðŸ”— ${currentProduct.link} 
#indirim #alÄ±ÅŸveriÅŸ #fÄ±rsat #online #ecommerce #tiktokshop #flashsale`
            };
            
            postsContainer.innerHTML = '';
            
            for (const [platform, content] of Object.entries(posts)) {
                const card = document.createElement('div');
                card.className = 'card mb-3';
                card.innerHTML = `
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <strong><i class="fab fa-${platform} me-2"></i>${platform.toUpperCase()}</strong>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="copyTextToClipboard(\`${content.replace(/`/g, '\\`')}\`)">
                                <i class="fas fa-copy"></i> Kopyala
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <textarea class="form-control" rows="4" readonly style="font-family: monospace; font-size: 14px;">${content}</textarea>
                    </div>
                `;
                postsContainer.appendChild(card);
            }
        }
        
        function copyTextToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Metin panoya kopyalandÄ±!');
            }).catch(err => {
                console.error('Kopyalama hatasÄ±:', err);
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Metin kopyalandÄ±!');
            });
        }
        
        function copyFileName() {
            const input = document.getElementById('videoFileName');
            input.select();
            document.execCommand('copy');
            alert('Dosya adÄ± kopyalandÄ±!');
        }
        
        function shareToInstagram() {
            copyTextToClipboard(document.querySelector('#socialMediaPosts textarea').value);
            alert('Instagram paylaÅŸÄ±m metni kopyalandÄ±!\n\nVideoyu Instagram\'a yÃ¼kleyin ve bu metni aÃ§Ä±klamaya yapÄ±ÅŸtÄ±rÄ±n.');
        }
        
        function shareToTwitter() {
            const text = document.querySelectorAll('#socialMediaPosts textarea')[1].value;
            const encodedText = encodeURIComponent(text.substring(0, 280));
            window.open(`https://twitter.com/intent/tweet?text=${encodedText}`, '_blank', 'width=600,height=400');
        }
        
        function shareToFacebook() {
            const text = document.querySelectorAll('#socialMediaPosts textarea')[2].value.substring(0, 200);
            const encodedText = encodeURIComponent(text);
            const encodedUrl = encodeURIComponent(currentProduct.link);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}&quote=${encodedText}`, '_blank', 'width=600,height=400');
        }
        
        function shareToTiktok() {
            copyTextToClipboard(document.querySelectorAll('#socialMediaPosts textarea')[3].value);
            alert('TikTok paylaÅŸÄ±m metni kopyalandÄ±!\n\nVideoyu TikTok\'a yÃ¼kleyin ve bu metni aÃ§Ä±klamaya yapÄ±ÅŸtÄ±rÄ±n.');
        }
    </script>
</body>
</html>
